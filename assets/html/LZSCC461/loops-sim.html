<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Loops, Conditional Statements, and Simulation | Lancaster University Leipzig LZSCC.461 R Programming</title>
  <meta name="description" content="3 Loops, Conditional Statements, and Simulation | Lancaster University Leipzig LZSCC.461 R Programming" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Loops, Conditional Statements, and Simulation | Lancaster University Leipzig LZSCC.461 R Programming" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Loops, Conditional Statements, and Simulation | Lancaster University Leipzig LZSCC.461 R Programming" />
  
  
  

<meta name="author" content="Lecturer: Robert Lösch" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="time.html"/>
<link rel="next" href="string.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="libs/detect-resize-0.5.3/jquery.resize.js"></script>
<link href="libs/jquery-ui-1.11.4/jquery-ui.min.css" rel="stylesheet" />
<script src="libs/jquery-ui-1.11.4/jquery-ui.min.js"></script>
<script src="libs/d3-3.5.2/d3.min.js"></script>
<script src="libs/vega-1.4.3/vega.min.js"></script>
<script src="libs/lodash-4.17.21/lodash.min.js"></script>
<script>var lodash = _.noConflict();</script>
<link href="libs/ggvis-0.4.9/css/ggvis.css" rel="stylesheet" />
<script src="libs/ggvis-0.4.9/js/ggvis.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><strong>0</strong> Introduction to R</a>
<ul>
<li class="chapter" data-level="0.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#background"><i class="fa fa-check"></i><b>0.1</b> Background</a></li>
<li class="chapter" data-level="0.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-your-work"><i class="fa fa-check"></i><b>0.2</b> Saving your work</a></li>
<li class="chapter" data-level="0.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started"><i class="fa fa-check"></i><b>0.3</b> Getting started</a></li>
<li class="chapter" data-level="0.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#s:0help"><i class="fa fa-check"></i><b>0.4</b> Getting Help</a></li>
<li class="chapter" data-level="0.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-scripts"><i class="fa fa-check"></i><b>0.5</b> R scripts</a></li>
<li class="chapter" data-level="0.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-markdown"><i class="fa fa-check"></i><b>0.6</b> R Markdown</a></li>
<li class="chapter" data-level="0.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>0.7</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="read-plot.html"><a href="read-plot.html"><i class="fa fa-check"></i><b>1</b> Data manipulation and plotting in R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="read-plot.html"><a href="read-plot.html#before-getting-started"><i class="fa fa-check"></i><b>1.1</b> Before getting started</a></li>
<li class="chapter" data-level="1.2" data-path="read-plot.html"><a href="read-plot.html#working-with-data-in-modern-r"><i class="fa fa-check"></i><b>1.2</b> Working with data in modern R</a></li>
<li class="chapter" data-level="1.3" data-path="read-plot.html"><a href="read-plot.html#data-types"><i class="fa fa-check"></i><b>1.3</b> Data Types</a></li>
<li class="chapter" data-level="1.4" data-path="read-plot.html"><a href="read-plot.html#logical-comparisons-and-boolean-operations"><i class="fa fa-check"></i><b>1.4</b> Logical comparisons and Boolean operations</a></li>
<li class="chapter" data-level="1.5" data-path="read-plot.html"><a href="read-plot.html#plots"><i class="fa fa-check"></i><b>1.5</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>2</b> Time manipulation, aggregation and summarisation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="time.html"><a href="time.html#from-last-week"><i class="fa fa-check"></i><b>2.1</b> From last week</a></li>
<li class="chapter" data-level="2.2" data-path="time.html"><a href="time.html#dates-and-timestamps-in-r"><i class="fa fa-check"></i><b>2.2</b> Dates and timestamps in R</a></li>
<li class="chapter" data-level="2.3" data-path="time.html"><a href="time.html#summarising-data-over-time"><i class="fa fa-check"></i><b>2.3</b> Summarising data over time</a></li>
<li class="chapter" data-level="2.4" data-path="time.html"><a href="time.html#a-timestamp-split-over-several-columns"><i class="fa fa-check"></i><b>2.4</b> A timestamp split over several columns</a></li>
<li class="chapter" data-level="2.5" data-path="time.html"><a href="time.html#time-zones"><i class="fa fa-check"></i><b>2.5</b> Time zones</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="loops-sim.html"><a href="loops-sim.html"><i class="fa fa-check"></i><b>3</b> Loops, Conditional Statements, and Simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="loops-sim.html"><a href="loops-sim.html#before-you-start"><i class="fa fa-check"></i><b>3.1</b> Before you start</a></li>
<li class="chapter" data-level="3.2" data-path="loops-sim.html"><a href="loops-sim.html#loops"><i class="fa fa-check"></i><b>3.2</b> Loops</a></li>
<li class="chapter" data-level="3.3" data-path="loops-sim.html"><a href="loops-sim.html#conditional-statements"><i class="fa fa-check"></i><b>3.3</b> Conditional statements</a></li>
<li class="chapter" data-level="3.4" data-path="loops-sim.html"><a href="loops-sim.html#probability-and-simulation"><i class="fa fa-check"></i><b>3.4</b> Probability and Simulation</a></li>
<li class="chapter" data-level="3.5" data-path="loops-sim.html"><a href="loops-sim.html#combining-loops-and-simulation"><i class="fa fa-check"></i><b>3.5</b> Combining Loops and Simulation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>4</b> String processing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="string.html"><a href="string.html#preamble"><i class="fa fa-check"></i><b>4.1</b> Preamble</a></li>
<li class="chapter" data-level="4.2" data-path="string.html"><a href="string.html#introducing-regular-expressions"><i class="fa fa-check"></i><b>4.2</b> Introducing regular expressions</a></li>
<li class="chapter" data-level="4.3" data-path="string.html"><a href="string.html#working-with-strings-and-regular-expressions"><i class="fa fa-check"></i><b>4.3</b> Working with strings and regular expressions</a></li>
<li class="chapter" data-level="4.4" data-path="string.html"><a href="string.html#string-exercises"><i class="fa fa-check"></i><b>4.4</b> String Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="web-app.html"><a href="web-app.html"><i class="fa fa-check"></i><b>5</b> Web scraping, interactive graphics, Shiny Apps, package building, and more</a>
<ul>
<li class="chapter" data-level="5.1" data-path="web-app.html"><a href="web-app.html#packages"><i class="fa fa-check"></i><b>5.1</b> Packages</a></li>
<li class="chapter" data-level="5.2" data-path="web-app.html"><a href="web-app.html#collecting-data"><i class="fa fa-check"></i><b>5.2</b> Collecting data</a></li>
<li class="chapter" data-level="5.3" data-path="web-app.html"><a href="web-app.html#alternative-graphics"><i class="fa fa-check"></i><b>5.3</b> Alternative graphics</a></li>
<li class="chapter" data-level="5.4" data-path="web-app.html"><a href="web-app.html#shiny-web-applications"><i class="fa fa-check"></i><b>5.4</b> Shiny Web Applications</a></li>
<li class="chapter" data-level="5.5" data-path="web-app.html"><a href="web-app.html#r-markdown-html-notebooks-and-ipythonjupyter-notebooks"><i class="fa fa-check"></i><b>5.5</b> R Markdown HTML notebooks and IPython/Jupyter notebooks</a></li>
<li class="chapter" data-level="5.6" data-path="web-app.html"><a href="web-app.html#exercise-housing-in-nairobi"><i class="fa fa-check"></i><b>5.6</b> Exercise: Housing in Nairobi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i>Further reading</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lancaster University Leipzig LZSCC.461 R Programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="loops-sim" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Loops, Conditional Statements, and Simulation<a href="loops-sim.html#loops-sim" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="before-you-start" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Before you start<a href="loops-sim.html#before-you-start" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Revise the Summary sections on Data Manipulation and Basic Plots
from the first week. Also scan through the section on Logical
Comparisons. You will be making use of this knowledge this week.</li>
<li>Load the good old <code>tidyverse</code>:</li>
</ul>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="loops-sim.html#cb412-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<ul>
<li>The purpose of this chapter is to get you writing and thinking about
<code>for</code> loops and conditional statements, also known as <code>if</code>
statements. The second half of the chapter focuses on probability
simulation.</li>
</ul>
</div>
<div id="loops" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Loops<a href="loops-sim.html#loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Wrapping a block of code inside a <code>for</code> loop, means that the code can be
repeatedly executed. Because of this, a <code>for</code> loop is classified as an
iteration statement; we repeatedly iterate over the same code, with,
typically, only one or two parameters changing each time.</p>
<p>For instance, a <code>for</code> loop can be used to make the following sequence of
numbers. Can you see the pattern?</p>
<p>1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, …</p>
<p>The sequence is known as the Fibonacci sequence which is calculated as
follows; starting with 1 and 1, each subsequent number is the sum of the
previous two. We will use this sequence as an example for learning about
loops in R.</p>
<p>First, we will need to cover another way to pick out individual elements
from a vector. We have seen in previous chapters, that we can use
<code>filter()</code> to reduce a data frame. And we have seen that we can pass a
logical vector (a vector containing a series of <code>TRUE</code> and <code>FALSE</code>
values) to select out elements of a different vector:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="loops-sim.html#cb413-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb413-2"><a href="loops-sim.html#cb413-2" tabindex="-1"></a>which <span class="ot">&lt;-</span> x <span class="sc">&lt;</span> <span class="dv">3</span></span>
<span id="cb413-3"><a href="loops-sim.html#cb413-3" tabindex="-1"></a>which</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="loops-sim.html#cb415-1" tabindex="-1"></a>x[which]</span></code></pre></div>
<pre><code>## [1] 0 1 2</code></pre>
<p>Here, we will be using the index method. In your <strong>script</strong>, store the
first six numbers of the Fibonacci sequence in a vector, and run this.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="loops-sim.html#cb417-1" tabindex="-1"></a>fib <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>)</span></code></pre></div>
<p>Now, in order to access the third element, we use square brackets:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="loops-sim.html#cb418-1" tabindex="-1"></a>fib[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>In order to extract a larger subset we specify a vector of indices, or
we can use the colon shortcut:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="loops-sim.html#cb420-1" tabindex="-1"></a>fib[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1] 2 3 5</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="loops-sim.html#cb422-1" tabindex="-1"></a>fib[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] 2 3 5</code></pre>
<p>To generalise, if <code>x</code> is a vector, and <code>i</code> is a positive integer, then
<code>x[i]</code>, will be the <span class="math inline">\(i\)</span>th element of <code>x</code>. And if <code>y</code> is a vector of
positive integers, then <code>x[y]</code> gives the corresponding elements of <code>x</code>
as a vector (note that some programming languages like Python are zero
based which means the first element of a vector is referred to as
<code>x[0]</code>).</p>
<div id="writing-a-for-loop" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Writing a for loop<a href="loops-sim.html#writing-a-for-loop" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use a <code>for</code> loop to calculate, say, the first 100 numbers of the
Fibonacci sequence. In order to do this, we first need to understand two
things;</p>
<ol style="list-style-type: decimal">
<li>that this particular sequence has a recursive property, and</li>
<li>loops are one way in which we can implement such properties.</li>
</ol>
<p>What do we mean by <strong>recursive</strong>? Well, instead of writing out the
Fibonacci as just a sequence of numbers, we could instead use algebra:</p>
<p>1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, …</p>
<p><span class="math inline">\(r_1\)</span>, <span class="math inline">\(r_2\)</span>, <span class="math inline">\(r_3\)</span>, <span class="math inline">\(r_4\)</span>, <span class="math inline">\(r_5\)</span>, <span class="math inline">\(r_6\)</span>, <span class="math inline">\(r_7\)</span>, <span class="math inline">\(r_8\)</span>, <span class="math inline">\(r_9\)</span>, <span class="math inline">\(r_{10}\)</span>,
<span class="math inline">\(r_{11}\)</span>, <span class="math inline">\(r_{12}\)</span>, …</p>
<p>We already stated that, after the first two numbers, each subsequent
number is the sum of the previous two. Written mathematically this looks
like:</p>
<p><span class="math display">\[
r_{i} = r_{i - 1} + r_{i - 2} \quad \text{for}\quad i &gt; 2.
\]</span></p>
<p>So, the idea is to write code that lets <code>i</code> go from 3 up to 100, and as
it does so, we calculate the <span class="math inline">\(i\)</span>th value of the Fibonacci sequence,
storing the results in a vector:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="loops-sim.html#cb424-1" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb424-2"><a href="loops-sim.html#cb424-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb424-3"><a href="loops-sim.html#cb424-3" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>) <span class="co"># first two values</span></span>
<span id="cb424-4"><a href="loops-sim.html#cb424-4" tabindex="-1"></a></span>
<span id="cb424-5"><a href="loops-sim.html#cb424-5" tabindex="-1"></a><span class="co"># Fibonacci algorithm</span></span>
<span id="cb424-6"><a href="loops-sim.html#cb424-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>n) {</span>
<span id="cb424-7"><a href="loops-sim.html#cb424-7" tabindex="-1"></a>    r[i] <span class="ot">&lt;-</span> r[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> r[i <span class="sc">-</span> <span class="dv">2</span>]</span>
<span id="cb424-8"><a href="loops-sim.html#cb424-8" tabindex="-1"></a>}</span></code></pre></div>
<p>Before you run the script, let us examine what is happening
line-by-line. The two lines under the heading <code># parameters</code> set-up the
workspace; <code>n</code> contains the how many numbers we want to generate, and
<code>r</code> initialises the sequence.</p>
<p>The next section defines the Fibonacci sequence using a for loop. There
are two parts to specifying a <code>for</code> loop. There is the index which is
specified in the round brackets, and then there is the code to be
repeated between the curly brackets:</p>
<p><img src="week2/loop.png" width="50%" /></p>
<p>When specifying the index, we use the phrase <code>in</code> rather than an equals
symbol.</p>
<p>If everything goes well when you run the code, your <code>r</code> vector should
now contain 100 elements, you should check this. Also check some of the
elements against the sequence stated above. For instance the 12th number
should be 144.</p>
</div>
<div id="population-growth" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Population growth<a href="loops-sim.html#population-growth" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Fibonacci sequence might seem a little too abstract of a concept to
justify why you should be interested in loops. So, let us take another
example; wildlife population growth models.</p>
<p>Wild animals typically go through three stages as part of their
life-history; juvenile, subadult, and adult. With juveniles being
defined as those being born within one time-period (typically a year).
Subadults are no longer juveniles, but still remain non-reproductive (1
to 2 years old). And adults being the reproductive members of the
population (2 or more years old).</p>
<p>The reason why we separate juveniles and subadults, is that juveniles
often have a much lower rate of survival than subadults. With adults
having an even greater rate of survival year-on-year, than the other
two.</p>
<p>So, with population growth modelling, the idea is that given a starting
size for each of these subgroups, the survival/death rate of each
subgroup, and the reproductive rate of the adults, we should then be
able to simulate what we expect to happen to the subpopulations over
time.</p>
<p>To keep track of the size of population subgroups, we let <span class="math inline">\(J\)</span>, <span class="math inline">\(S\)</span> and
<span class="math inline">\(A\)</span> represent the size of the juveniles, subadults, and adults,
respectively. Each of these numbers will change over time, such that
<span class="math inline">\(J_t\)</span> will represent the size of the juvenile group at time <span class="math inline">\(t\)</span>.</p>
<p>To begin specifying models for how the subgroups change over time, let
us start with the easiest, the transition from Juvenile to Subadult: <span class="math display">\[
S_{(t+1)} = p_0 J_t.
\]</span> Where <span class="math inline">\(p_0\)</span> is the proportion that survive to the subadult stage.
Similarly, we define the proportion of subadults that survive as <span class="math inline">\(p_1\)</span>,
and adults as <span class="math inline">\(p_2\)</span>.</p>
<p><img src="week2/growth-diagram.png" width="50%" /></p>
<p>The number of adults at time <span class="math inline">\(t+1\)</span> has two sources: <span class="math display">\[
A_{(t+1)} = p_1 S_t + p_2 A_t.
\]</span> One way to read this is in the following way; the number of subadults
that survived to adulthood plus the number of adults that have not died.</p>
<p>Finally, to model the juveniles, we need to know what proportion of the
adults produce offspring, let this be represented by <span class="math inline">\(f\)</span>. So, that the
juveniles at time <span class="math inline">\(t+1\)</span> are estimated by the equation: <span class="math display">\[
J_{(t+1)} = f A_t.
\]</span></p>
<p>Collectively, these equations take the current sizes of each subgroup;
<span class="math inline">\(J_t, S_t, A_t\)</span>, and then calculate their size one time-period from now.</p>
<p>To implement this in R, we will use a for loop. We will store population
sizes at each time in three vectors; <code>J</code>, <code>S</code>, and <code>A</code>, representing
juveniles, subadults and adults, respectively.</p>
<p>In order to give initial sizes to the populations, as well as numbers
for the constants; <span class="math inline">\(p_0\)</span>, <span class="math inline">\(p_1\)</span>, <span class="math inline">\(p_2\)</span>, and <span class="math inline">\(f\)</span>, we need to look at a
real-life case study. For this we look towards research on the Northern
Spotted Owl which is a threatened species that lives and nests primarily
in north west America, shown in Figure <a href="loops-sim.html#fig:owl">3.1</a>.</p>
<p>Noon and Biles (1990) extracted estimates for these constants from
various field studies; <span class="math inline">\(p_0=0.11\)</span>, <span class="math inline">\(p_1=0.71\)</span>, <span class="math inline">\(p_2=0.94\)</span>, <span class="math inline">\(f=0.24\)</span>.
These numbers apply to female owls only, which is a common convention in
population studies of species which have a constant ratio of males and
females. Thus, our <span class="math inline">\(J\)</span>, <span class="math inline">\(S\)</span>, and <span class="math inline">\(A\)</span> parameters refer only to the number
of females at each time period.</p>
<div class="figure"><span style="display:block;" id="fig:owl"></span>
<img src="week2/Northern_Spotted_Owl.jpg" alt="Northern spotted owl, a near threatened species whose wingspan is approximately one metre." width="50%" />
<p class="caption">
Figure 3.1: Northern spotted owl, a near threatened species whose wingspan is approximately one metre.
</p>
</div>
<p>To implement the population growth model of female northern spotted
owls, we have several tasks in front of us:</p>
<ol style="list-style-type: decimal">
<li><p>Start a new script. Add a series of comments at the top outlining
what the script will do.</p></li>
<li><p>Define the number of years we wish to project for.</p></li>
</ol>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="loops-sim.html#cb425-1" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="dv">20</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p>Define the constants from the text above as objects.</p></li>
<li><p>Create three vectors to store the population sizes of each of the
age groups. At the start, the vectors should only contain the
following initial population sizes:</p></li>
</ol>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="loops-sim.html#cb426-1" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="dv">1200</span></span>
<span id="cb426-2"><a href="loops-sim.html#cb426-2" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">800</span></span>
<span id="cb426-3"><a href="loops-sim.html#cb426-3" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="dv">2000</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Construct a <code>for</code> loop with an index to represent time:</li>
</ol>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="loops-sim.html#cb427-1" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>years) {</span>
<span id="cb427-2"><a href="loops-sim.html#cb427-2" tabindex="-1"></a>    <span class="co"># population equations go here</span></span>
<span id="cb427-3"><a href="loops-sim.html#cb427-3" tabindex="-1"></a>}</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Put the three population equations inside the for loop, using the
index to pick out appropriate elements of the vectors. And store our
new estimates. For example, adding the subadult equation would look
like:</li>
</ol>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="loops-sim.html#cb428-1" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>years) {</span>
<span id="cb428-2"><a href="loops-sim.html#cb428-2" tabindex="-1"></a>    <span class="co"># subadult equation</span></span>
<span id="cb428-3"><a href="loops-sim.html#cb428-3" tabindex="-1"></a>    S[t] <span class="ot">&lt;-</span> p0 <span class="sc">*</span> J[t<span class="dv">-1</span>]</span>
<span id="cb428-4"><a href="loops-sim.html#cb428-4" tabindex="-1"></a></span>
<span id="cb428-5"><a href="loops-sim.html#cb428-5" tabindex="-1"></a>    <span class="co"># adult equation goes here</span></span>
<span id="cb428-6"><a href="loops-sim.html#cb428-6" tabindex="-1"></a></span>
<span id="cb428-7"><a href="loops-sim.html#cb428-7" tabindex="-1"></a>    <span class="co"># juvenile equation goes here</span></span>
<span id="cb428-8"><a href="loops-sim.html#cb428-8" tabindex="-1"></a>}</span></code></pre></div>
<p>Complete for the other subgroup equations.</p>
<ol start="7" style="list-style-type: decimal">
<li>Create a data frame called <code>owl_pop</code> with three
variables; <code>time</code>, <code>group</code>, and <code>size</code>. Each row should contain the
size at a single time point for one of the three subpopulations
(juvenile, subadult, and adult), such that it looks like this:</li>
</ol>
<pre><code>   nrow(owl_pop)
[1] 60
   head(owl_pop)
  time group      size
1    1     J 1200.0000
2    2     J  480.0000
3    3     J  587.5200
4    4     J  574.7616
5    5     J  549.2730
6    6     J  527.3291</code></pre>
<p>To do this you will:</p>
<ul>
<li>Need to use the <code>rep()</code> function, check it’s help page for details.</li>
<li>Make sure <code>group</code> is a factor with sensible labels.</li>
<li>Ask us for help.</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>Create a plot using <code>ggplot()</code> and <code>owl_pop</code> showing the changes in
the three subpopulations over time. Things to consider:</li>
</ol>
<ul>
<li>How do you plot lines instead of points?</li>
<li>How do you tell ggplot to plot separate lines for each of the three
groups in your data?</li>
<li>Are you happy with your axis labels?</li>
</ul>
<p>Your plot should look something like this:</p>
<p><img src="images/owl-pop-1.png" width="70%" /></p>
</div>
<div id="when-not-to-loop" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> When not to loop<a href="loops-sim.html#when-not-to-loop" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the first two weeks we have used only <strong>Vectorized functions.</strong> Those
are in R inherently designed to operate on whole vectors directly. This
means they can perform an operation on each element of a vector
simultaneously, making them highly efficient and fast. Technically, we
say that vectorised functions are <em>trivially parallelizable</em> because
there’s no dependency between elements (the value of an element of a
vector does not depend on the previous one). While vectorized functions
are highly efficient in R, and you should use them as much as you can,
they are not suitable for all programming tasks, particularly when the
computation of an element depends on the previous ones, i.e., when there
is a <strong>state</strong> involved.</p>
<p>The concept of <strong>state</strong> refers to a scenario where certain steps in
your code must be executed in a specific order because the output of one
step is the input to the next step. This is common in tasks that involve
iterative calculations: in our example, we have used <code>for</code> loops to
generate data based on a model. Each new value we calculated was based
on at least one previously calculated value. This is, pretty much, the
only circumstances in which for looping is definitely the answer.</p>
<p>Often with data problems it is very tempting to create a solution using
a <code>for</code> loop, but what you might find, especially in R, is that your
solution takes a long time to run. When this happens there is frequently
an alternative solution which involves using vectors instead. For a
trivial example, say, we have an incredibly long vector which want to
square:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="loops-sim.html#cb430-1" tabindex="-1"></a><span class="co"># for-loop method</span></span>
<span id="cb430-2"><a href="loops-sim.html#cb430-2" tabindex="-1"></a>square_x_loop <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb430-3"><a href="loops-sim.html#cb430-3" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">^</span><span class="dv">7</span> <span class="co"># 10 million</span></span>
<span id="cb430-4"><a href="loops-sim.html#cb430-4" tabindex="-1"></a></span>
<span id="cb430-5"><a href="loops-sim.html#cb430-5" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb430-6"><a href="loops-sim.html#cb430-6" tabindex="-1"></a>        x[i] <span class="ot">&lt;-</span> x[i]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb430-7"><a href="loops-sim.html#cb430-7" tabindex="-1"></a>    }</span>
<span id="cb430-8"><a href="loops-sim.html#cb430-8" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb430-9"><a href="loops-sim.html#cb430-9" tabindex="-1"></a>}</span>
<span id="cb430-10"><a href="loops-sim.html#cb430-10" tabindex="-1"></a></span>
<span id="cb430-11"><a href="loops-sim.html#cb430-11" tabindex="-1"></a><span class="co"># vector method</span></span>
<span id="cb430-12"><a href="loops-sim.html#cb430-12" tabindex="-1"></a>square_x_vector <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb430-13"><a href="loops-sim.html#cb430-13" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">^</span><span class="dv">7</span> <span class="co"># 10 million</span></span>
<span id="cb430-14"><a href="loops-sim.html#cb430-14" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb430-15"><a href="loops-sim.html#cb430-15" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb430-16"><a href="loops-sim.html#cb430-16" tabindex="-1"></a>}</span>
<span id="cb430-17"><a href="loops-sim.html#cb430-17" tabindex="-1"></a></span>
<span id="cb430-18"><a href="loops-sim.html#cb430-18" tabindex="-1"></a><span class="co"># how much time does each method take to execute?</span></span>
<span id="cb430-19"><a href="loops-sim.html#cb430-19" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">square_x_loop</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.395   0.009   0.405</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="loops-sim.html#cb432-1" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">square_x_vector</span>())</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.013   0.005   0.018</code></pre>
<p>The <code>for</code> loop took significantly longer than the vector approach. This
is because of the way R is optimised for thinking with vectors, rather
than thinking about processing individual values. With other more
low-level programming languages you might not see any difference in
terms of speed between these two methods, in fact it might even be the
other way around.</p>
<p>So when coding in R, think vectors first (ask yourself, are the elements
of my output independent from each-other?). If so, avoid <code>for</code> cycles. In
all other cases, where looping seems to solve your problem in a timely
manner this is good enough.</p>
<p>In other words, don’t be this guy:</p>
<p><img src="week2/not_the_same.png" width="342" /></p>
</div>
<div id="summary-2" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Summary<a href="loops-sim.html#summary-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Elements of vectors can be picked out of the vector using one or
more indexes:</li>
</ol>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="loops-sim.html#cb434-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)</span>
<span id="cb434-2"><a href="loops-sim.html#cb434-2" tabindex="-1"></a>x[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="loops-sim.html#cb436-1" tabindex="-1"></a>x[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="loops-sim.html#cb438-1" tabindex="-1"></a>x[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;e&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>A <code>for</code> loop repeatedly executes a block of code. The number of
repetitions is based on the size of the sequence passed to the
index. The index itself is an object which can be used within the
block of code.</li>
</ol>
<p>Example:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="loops-sim.html#cb440-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)) {</span>
<span id="cb440-2"><a href="loops-sim.html#cb440-2" tabindex="-1"></a>    <span class="co"># code to repeatedly execute</span></span>
<span id="cb440-3"><a href="loops-sim.html#cb440-3" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb440-4"><a href="loops-sim.html#cb440-4" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;
## [1] &quot;b&quot;
## [1] &quot;c&quot;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>Recursive equations, or problems that involve calculating values
based on previous values in the sequence are solved most excellently
with <code>for</code> loops.</p></li>
<li><p>If you write a loop and it executes very slowly, cancel it, and see
if there is a better approach. There usually is, and it will most
likely involve vectors.</p></li>
</ol>
</div>
</div>
<div id="conditional-statements" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Conditional statements<a href="loops-sim.html#conditional-statements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Like all other programming languages, R can execute a block of code
conditional on whether or not a statement is true. This is done by using
the <code>if</code> command, here is one in action:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="loops-sim.html#cb442-1" tabindex="-1"></a><span class="cf">for</span> (animal <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;human&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;turtle&quot;</span>, <span class="st">&quot;zebra&quot;</span>)) {</span>
<span id="cb442-2"><a href="loops-sim.html#cb442-2" tabindex="-1"></a>    <span class="co"># decide on food given to type of animal</span></span>
<span id="cb442-3"><a href="loops-sim.html#cb442-3" tabindex="-1"></a>    <span class="cf">if</span> (animal <span class="sc">==</span> <span class="st">&quot;cat&quot;</span>) {</span>
<span id="cb442-4"><a href="loops-sim.html#cb442-4" tabindex="-1"></a>        <span class="co"># when TRUE run this</span></span>
<span id="cb442-5"><a href="loops-sim.html#cb442-5" tabindex="-1"></a>        food <span class="ot">&lt;-</span> <span class="st">&quot;fish&quot;</span></span>
<span id="cb442-6"><a href="loops-sim.html#cb442-6" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb442-7"><a href="loops-sim.html#cb442-7" tabindex="-1"></a>        <span class="co"># when FALSE run this</span></span>
<span id="cb442-8"><a href="loops-sim.html#cb442-8" tabindex="-1"></a>        food <span class="ot">&lt;-</span> <span class="st">&quot;pizza&quot;</span></span>
<span id="cb442-9"><a href="loops-sim.html#cb442-9" tabindex="-1"></a>    }</span>
<span id="cb442-10"><a href="loops-sim.html#cb442-10" tabindex="-1"></a>      </span>
<span id="cb442-11"><a href="loops-sim.html#cb442-11" tabindex="-1"></a>    <span class="co"># compose message</span></span>
<span id="cb442-12"><a href="loops-sim.html#cb442-12" tabindex="-1"></a>    msg <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Give a&quot;</span>, animal, <span class="st">&quot;some&quot;</span>, food, <span class="st">&quot;for lunch.&quot;</span>)</span>
<span id="cb442-13"><a href="loops-sim.html#cb442-13" tabindex="-1"></a>    <span class="fu">print</span>(msg)</span>
<span id="cb442-14"><a href="loops-sim.html#cb442-14" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Give a human some pizza for lunch.&quot;
## [1] &quot;Give a cat some fish for lunch.&quot;
## [1] &quot;Give a turtle some pizza for lunch.&quot;
## [1] &quot;Give a zebra some pizza for lunch.&quot;</code></pre>
<p>which generates a message for each animal.</p>
<p>The structure of an <code>if</code> statement is very similar to that of a <code>for</code>
loop. The code they execute (or do not execute) lies between curly
brackets. Whether or not an <code>if</code> statement executes a particular block
of code depends on the whether or not the conditional statement is true
or false.</p>
<p>If we wanted to also feed fish to turtles, and perhaps give something
more appropriate to zebras such as grass, then modify the above code so
it reads:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="loops-sim.html#cb444-1" tabindex="-1"></a><span class="cf">for</span> (animal <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;human&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;turtle&quot;</span>, <span class="st">&quot;zebra&quot;</span>)) {</span>
<span id="cb444-2"><a href="loops-sim.html#cb444-2" tabindex="-1"></a>    <span class="co"># decide on food given to type of animal</span></span>
<span id="cb444-3"><a href="loops-sim.html#cb444-3" tabindex="-1"></a>    <span class="cf">if</span> (animal <span class="sc">==</span> <span class="st">&quot;cat&quot;</span> <span class="sc">|</span> animal <span class="sc">==</span> <span class="st">&quot;turtle&quot;</span>) {</span>
<span id="cb444-4"><a href="loops-sim.html#cb444-4" tabindex="-1"></a>        food <span class="ot">&lt;-</span> <span class="st">&quot;fish&quot;</span></span>
<span id="cb444-5"><a href="loops-sim.html#cb444-5" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (animal <span class="sc">==</span> <span class="st">&quot;human&quot;</span>) {</span>
<span id="cb444-6"><a href="loops-sim.html#cb444-6" tabindex="-1"></a>        food <span class="ot">&lt;-</span> <span class="st">&quot;pizza&quot;</span></span>
<span id="cb444-7"><a href="loops-sim.html#cb444-7" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (animal <span class="sc">==</span> <span class="st">&quot;zebra&quot;</span>) {</span>
<span id="cb444-8"><a href="loops-sim.html#cb444-8" tabindex="-1"></a>        food <span class="ot">&lt;-</span> <span class="st">&quot;grass&quot;</span></span>
<span id="cb444-9"><a href="loops-sim.html#cb444-9" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb444-10"><a href="loops-sim.html#cb444-10" tabindex="-1"></a>        food <span class="ot">&lt;-</span> <span class="st">&quot;soup&quot;</span></span>
<span id="cb444-11"><a href="loops-sim.html#cb444-11" tabindex="-1"></a>    }</span>
<span id="cb444-12"><a href="loops-sim.html#cb444-12" tabindex="-1"></a>   </span>
<span id="cb444-13"><a href="loops-sim.html#cb444-13" tabindex="-1"></a>    <span class="co"># compose message</span></span>
<span id="cb444-14"><a href="loops-sim.html#cb444-14" tabindex="-1"></a>    msg <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Give a&quot;</span>, animal, <span class="st">&quot;some&quot;</span>, food, <span class="st">&quot;for lunch.&quot;</span>)</span>
<span id="cb444-15"><a href="loops-sim.html#cb444-15" tabindex="-1"></a>    <span class="fu">print</span>(msg)</span>
<span id="cb444-16"><a href="loops-sim.html#cb444-16" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Give a human some pizza for lunch.&quot;
## [1] &quot;Give a cat some fish for lunch.&quot;
## [1] &quot;Give a turtle some fish for lunch.&quot;
## [1] &quot;Give a zebra some grass for lunch.&quot;</code></pre>
<p>See how the printed messages have changed.</p>
<p>An example in statistics when we would use an <code>if</code> statement is when we
are creating a basic probability event simulator, such as rolling dice,
or dealing cards. To simulate rolling a six-sided die we would write a
function which would:</p>
<ol style="list-style-type: decimal">
<li>Draw a random number between 0 and 1. We use <code>runif()</code> for this.</li>
<li>Use <code>if</code> statements to workout the dice face based on the random
number.</li>
<li>Return the dice roll result back to the user.</li>
</ol>
<p>In your script, type and run:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="loops-sim.html#cb446-1" tabindex="-1"></a>roll_d6 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb446-2"><a href="loops-sim.html#cb446-2" tabindex="-1"></a>    <span class="co"># draw random number between 0 and 1</span></span>
<span id="cb446-3"><a href="loops-sim.html#cb446-3" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb446-4"><a href="loops-sim.html#cb446-4" tabindex="-1"></a>    </span>
<span id="cb446-5"><a href="loops-sim.html#cb446-5" tabindex="-1"></a>    <span class="co"># allocate dice face</span></span>
<span id="cb446-6"><a href="loops-sim.html#cb446-6" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb446-7"><a href="loops-sim.html#cb446-7" tabindex="-1"></a>        face <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb446-8"><a href="loops-sim.html#cb446-8" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb446-9"><a href="loops-sim.html#cb446-9" tabindex="-1"></a>        face <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb446-10"><a href="loops-sim.html#cb446-10" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb446-11"><a href="loops-sim.html#cb446-11" tabindex="-1"></a>        face <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb446-12"><a href="loops-sim.html#cb446-12" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb446-13"><a href="loops-sim.html#cb446-13" tabindex="-1"></a>        face <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb446-14"><a href="loops-sim.html#cb446-14" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb446-15"><a href="loops-sim.html#cb446-15" tabindex="-1"></a>        face <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb446-16"><a href="loops-sim.html#cb446-16" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb446-17"><a href="loops-sim.html#cb446-17" tabindex="-1"></a>        face <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb446-18"><a href="loops-sim.html#cb446-18" tabindex="-1"></a>    }</span>
<span id="cb446-19"><a href="loops-sim.html#cb446-19" tabindex="-1"></a>    </span>
<span id="cb446-20"><a href="loops-sim.html#cb446-20" tabindex="-1"></a>    <span class="fu">return</span>(face)</span>
<span id="cb446-21"><a href="loops-sim.html#cb446-21" tabindex="-1"></a> }</span>
<span id="cb446-22"><a href="loops-sim.html#cb446-22" tabindex="-1"></a></span>
<span id="cb446-23"><a href="loops-sim.html#cb446-23" tabindex="-1"></a><span class="fu">roll_d6</span>()</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>The function currently has no arguments, this is because everything
about rolling a single dice is fixed. A feature that we could add is to
allow multiple dice rolls with one call to <code>roll_d6()</code>, though we should
assume by default that the user just wants a single roll. Modify
<code>roll_d6()</code> to allow for this by looping over the existing code within
the function <span class="math inline">\(n\)</span> times and storing the results:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="loops-sim.html#cb448-1" tabindex="-1"></a>roll_d6 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n=</span><span class="dv">1</span>) {</span>
<span id="cb448-2"><a href="loops-sim.html#cb448-2" tabindex="-1"></a>    <span class="co"># empty vector of results</span></span>
<span id="cb448-3"><a href="loops-sim.html#cb448-3" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">c</span>() </span>
<span id="cb448-4"><a href="loops-sim.html#cb448-4" tabindex="-1"></a>    <span class="co"># allocate dice face for each probability      </span></span>
<span id="cb448-5"><a href="loops-sim.html#cb448-5" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb448-6"><a href="loops-sim.html#cb448-6" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb448-7"><a href="loops-sim.html#cb448-7" tabindex="-1"></a>        </span>
<span id="cb448-8"><a href="loops-sim.html#cb448-8" tabindex="-1"></a>        <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb448-9"><a href="loops-sim.html#cb448-9" tabindex="-1"></a>            face <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb448-10"><a href="loops-sim.html#cb448-10" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb448-11"><a href="loops-sim.html#cb448-11" tabindex="-1"></a>            face <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb448-12"><a href="loops-sim.html#cb448-12" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb448-13"><a href="loops-sim.html#cb448-13" tabindex="-1"></a>            face <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb448-14"><a href="loops-sim.html#cb448-14" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb448-15"><a href="loops-sim.html#cb448-15" tabindex="-1"></a>            face <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb448-16"><a href="loops-sim.html#cb448-16" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">/</span> <span class="dv">6</span>) {</span>
<span id="cb448-17"><a href="loops-sim.html#cb448-17" tabindex="-1"></a>            face <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb448-18"><a href="loops-sim.html#cb448-18" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb448-19"><a href="loops-sim.html#cb448-19" tabindex="-1"></a>            face <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb448-20"><a href="loops-sim.html#cb448-20" tabindex="-1"></a>        }</span>
<span id="cb448-21"><a href="loops-sim.html#cb448-21" tabindex="-1"></a>        </span>
<span id="cb448-22"><a href="loops-sim.html#cb448-22" tabindex="-1"></a>        <span class="co"># store result</span></span>
<span id="cb448-23"><a href="loops-sim.html#cb448-23" tabindex="-1"></a>        results[i] <span class="ot">&lt;-</span> face</span>
<span id="cb448-24"><a href="loops-sim.html#cb448-24" tabindex="-1"></a>    }</span>
<span id="cb448-25"><a href="loops-sim.html#cb448-25" tabindex="-1"></a>    <span class="fu">return</span>(results)</span>
<span id="cb448-26"><a href="loops-sim.html#cb448-26" tabindex="-1"></a>}</span></code></pre></div>
<p>Here is an example of simulating 20 dice rolls.</p>
<p><img src="images/dice_hist-1.png" width="70%" /></p>
<p>Play with this function; simulate a number of dice rolls and plot a
graph of the results. Alter the number of dice rolls simulated, and see
what it does to the graph. Note that the dice results are perfectly
random, and any variation you see between the frequency of certain
numbers is purely due to chance.</p>
<div id="summary-3" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Summary<a href="loops-sim.html#summary-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can execute a single line of code or block of code based on a
certain logical comparison being true. This is done using an <code>if</code>
statement which can take the following form:<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="loops-sim.html#cb449-1" tabindex="-1"></a><span class="cf">if</span> ( condition1 ) {</span>
<span id="cb449-2"><a href="loops-sim.html#cb449-2" tabindex="-1"></a>    <span class="co"># code block 1</span></span>
<span id="cb449-3"><a href="loops-sim.html#cb449-3" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> ( condition2 ) {</span>
<span id="cb449-4"><a href="loops-sim.html#cb449-4" tabindex="-1"></a>    <span class="co"># code block 2</span></span>
<span id="cb449-5"><a href="loops-sim.html#cb449-5" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb449-6"><a href="loops-sim.html#cb449-6" tabindex="-1"></a>    <span class="co"># code block 3</span></span>
<span id="cb449-7"><a href="loops-sim.html#cb449-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="probability-and-simulation" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Probability and Simulation<a href="loops-sim.html#probability-and-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section utilises the probability concepts you have been introduced
to in other modules, and assumes that you are familiar with the concept
of a random variable; mainly that it is a quantity or measure that is
likely to vary if the process being observed was repeated. And that we
can use probability distributions to describe variables.</p>
<p>Think about how you would answer the following questions if asked:</p>
<ul>
<li>What is a random event?</li>
<li>What is a random number?</li>
<li>What are some common probability distributions? And what types of
data or processes might be described by them?</li>
</ul>
<p>In this section we will cover several topics:</p>
<ul>
<li>Why we use simulation.</li>
<li>How to draw random samples from a set.</li>
<li>How to draw values from a probability distribution.</li>
<li>How simulation can show the law of large numbers (LLN) in action.</li>
</ul>
<p>Firstly, a random event is simply an event for which we do not know,
<strong>for certain</strong>, what the outcome will be, though we may know the
probability of each possible outcome. Examples are; flipping a coin,
playing rock paper scissors, rolling dice, number of offspring, gender
of the offspring.</p>
<p><img src="week2/RPS.png" width="45%" /><img src="week2/D12.png" width="45%" /></p>
<div id="random-sampling" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Random sampling<a href="loops-sim.html#random-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Randomly sampling from a discrete set of values in R is easy! To do this
we use the <code>sample()</code> function, which resamples values from a vector,
with or without replacement. It has a number of different uses. In the
list below <code>n</code> is an integer, <code>x</code> is a vector, <code>p</code> is a vector of
probabilities with the same length of <code>x</code>:</p>
<ul>
<li><code>sample(n)</code> creates a vector of integers from 1 to <code>n</code>, in a random
order</li>
<li><code>sample(x)</code> randomly permute <code>x</code></li>
<li><code>sample(x, replace = TRUE)</code> a bootstrap sample</li>
<li><code>sample(x, n)</code> sample <code>n</code> times from <code>x</code> without replacement</li>
<li><code>sample(x, n, replace = TRUE)</code> sample <span class="math inline">\(n\)</span> times from <code>x</code> with
replacement</li>
<li><code>sample(x, n, replace = TRUE, prob = p)</code> same as above, but sample
each element of <code>x</code> with probability <code>p</code></li>
</ul>
</div>
<div id="rock-paper-scissors" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Rock, Paper, Scissors<a href="loops-sim.html#rock-paper-scissors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To begin implementing Rock, Paper, Scissors in R, we need to specify the
finite set of choices. Then sample once from it for each player:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="loops-sim.html#cb450-1" tabindex="-1"></a><span class="co"># set of possible choices</span></span>
<span id="cb450-2"><a href="loops-sim.html#cb450-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Rock&quot;</span>, <span class="st">&quot;Paper&quot;</span>, <span class="st">&quot;Scissors&quot;</span>)</span>
<span id="cb450-3"><a href="loops-sim.html#cb450-3" tabindex="-1"></a></span>
<span id="cb450-4"><a href="loops-sim.html#cb450-4" tabindex="-1"></a><span class="co"># players, make your choice</span></span>
<span id="cb450-5"><a href="loops-sim.html#cb450-5" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(x, <span class="dv">1</span>)</span>
<span id="cb450-6"><a href="loops-sim.html#cb450-6" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(x, <span class="dv">1</span>)</span></code></pre></div>
<p>Check the values of <code>p1</code> and <code>p2</code> to see who won. If you want to do best
of 3 do:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="loops-sim.html#cb451-1" tabindex="-1"></a><span class="co"># players, make your choice (three times)</span></span>
<span id="cb451-2"><a href="loops-sim.html#cb451-2" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(x, <span class="dv">3</span>)</span>
<span id="cb451-3"><a href="loops-sim.html#cb451-3" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(x, <span class="dv">3</span>)</span>
<span id="cb451-4"><a href="loops-sim.html#cb451-4" tabindex="-1"></a></span>
<span id="cb451-5"><a href="loops-sim.html#cb451-5" tabindex="-1"></a><span class="co"># best of 3</span></span>
<span id="cb451-6"><a href="loops-sim.html#cb451-6" tabindex="-1"></a><span class="fu">rbind</span>(p1, p2)</span></code></pre></div>
</div>
<div id="simulating-the-law-of-large-numbers" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Simulating the law of large numbers<a href="loops-sim.html#simulating-the-law-of-large-numbers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The law of large numbers is a theorem from mathematics which states the
following; if a random process could be repeated many, many, many times,
the long-run <em>proportion</em> (or fraction) of times that a particular
outcome happens <em>stabilises</em>. This means that for a small number of
repetitions, we can expect to see a large amount of variability
regarding the proportion that <em>hit</em>. Whereas, for a large number of
repetitions, the proportion of <em>hits</em> would be more stable (less
varied).</p>
<p>For example, when looking at science GCSE results from schools, we would
expect to see that for the small schools (often in a quaint village),
the proportion of the children obtaining a grade C or above would vary
wildly from small school to small school. However, looking at the same
proportion but for big city schools, we would expect to see less
variation in the proportion from big school to big school. Let us put
this in to action.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
<p>Start a script or R Markdown file, with a title-section including
information that we are simulating the law of large numbers. With the
particular application being that we are looking at how the variability
in the proportion of children obtaining a science GCSE grade C or above
within a school is dependent on the size of the school.</p>
<p>To start, we are going to use the <code>rbinom()</code> function to simulate one
schools worth of GCSE results. This function is one of the standard
functions that comes with R (no need for packages) and allows us to
randomly draw from a binomial distribution.</p>
<p>Looking at the help page to understand the arguments of <code>rbinom()</code>, set
the size of the trial to be <span class="math inline">\(30\)</span> (this is the size of one year group in
our small, quaint school). Set the probability of success to <span class="math inline">\(0.59\)</span>,
this is the probability of a grade C or above.</p>
<p>And set the number of observations to be one, as we’re only interested
in looking at one small school right now.</p>
<p>When you send this command to the console, it should return a count. To
express this as a proportion, update your command to divide by the size
of the school.</p>
<p>Now, we are interested in the results of <span class="math inline">\(100\)</span> schools of this size,
increase the number of observations accordingly. Create a data frame
with one column containing these results, and a second column containing
the size of the schools.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="loops-sim.html#cb452-1" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb452-2"><a href="loops-sim.html#cb452-2" tabindex="-1"></a>size  <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb452-3"><a href="loops-sim.html#cb452-3" tabindex="-1"></a>pr    <span class="ot">&lt;-</span> <span class="fl">0.59</span></span>
<span id="cb452-4"><a href="loops-sim.html#cb452-4" tabindex="-1"></a></span>
<span id="cb452-5"><a href="loops-sim.html#cb452-5" tabindex="-1"></a>tiny_schools <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb452-6"><a href="loops-sim.html#cb452-6" tabindex="-1"></a>    <span class="at">sci_prop =</span> <span class="fu">rbinom</span>(n_obs, size, pr),</span>
<span id="cb452-7"><a href="loops-sim.html#cb452-7" tabindex="-1"></a>    <span class="at">size     =</span> size</span>
<span id="cb452-8"><a href="loops-sim.html#cb452-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Repeat the above process, but create a new data frame for each of the
following sized schools; small (size of <span class="math inline">\(100\)</span>), medium schools (size of
<span class="math inline">\(200\)</span>), large (size of <span class="math inline">\(500\)</span>), and mega schools (size of <span class="math inline">\(1000\)</span>).
Combine the rows of each of these data frames into one data frame by
using <code>rbind()</code> as follows:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="loops-sim.html#cb453-1" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb453-2"><a href="loops-sim.html#cb453-2" tabindex="-1"></a>    tiny_schools,</span>
<span id="cb453-3"><a href="loops-sim.html#cb453-3" tabindex="-1"></a>    small_schools,</span>
<span id="cb453-4"><a href="loops-sim.html#cb453-4" tabindex="-1"></a>    medium_schools,</span>
<span id="cb453-5"><a href="loops-sim.html#cb453-5" tabindex="-1"></a>    large_schools,</span>
<span id="cb453-6"><a href="loops-sim.html#cb453-6" tabindex="-1"></a>    mega_schools</span>
<span id="cb453-7"><a href="loops-sim.html#cb453-7" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:gcse"></span>
<img src="images/gcse-1.png" alt="Variation in proportion due to size of the year group. Demonstrating the law of large numbers." width="70%" />
<p class="caption">
Figure 3.2: Variation in proportion due to size of the year group. Demonstrating the law of large numbers.
</p>
</div>
<p>Create a <code>ggplot</code> comparing school size to the proportion of those of
who got grades C and above. Check if it looks similar to Figure
<a href="loops-sim.html#fig:gcse">3.2</a>.</p>
<p>How do you interpret this plot? Well, for a start, we know from our code
that all children across all schools had the same probability of getting
a grade C or above, so no school is inherently doing anything different
in preparing it’s children for the GCSE exams. In fact, the only thing
we allowed to vary was the size of the school. So the variation we are
seeing in regards to the proportion of students who obtained a grade C
or above within each school is related to the size of the year group at
that school. And we see that the big year groups, tend to be closer to
the true proportion than the smaller groups. This is the law of large
numbers.</p>
<p>If you did not know about the law of large numbers, and you were to
simply look at the top 25 schools, then you would likely conclude that
small schools are better than big schools, as the top ranks are
dominated by the smaller-sized schools. We can see the top 25 schools
with:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="loops-sim.html#cb454-1" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">arrange</span>(schools, <span class="fu">desc</span>(sci_prop<span class="sc">/</span>size))</span>
<span id="cb454-2"><a href="loops-sim.html#cb454-2" tabindex="-1"></a>schools[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, ]</span></code></pre></div>
</div>
<div id="probability-distributions" class="section level3 hasAnchor" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> Probability distributions<a href="loops-sim.html#probability-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R provides built-in functions that allow us to compute the density,
cumulative probability, quantiles and random numbers from many standard
probability distributions. Here we will look at the normal distribution
and the binomial distribution, but other distributions follow exactly
the same pattern. Table <a href="loops-sim.html#tab:rfunc">3.1</a> contains a list of random
generator functions for some of the standard probability distributions.
The first parameter of these functions is always <code>n</code> which is the number
of random values that you want to generate.</p>
<table>
<caption><span id="tab:rfunc">Table 3.1: </span> Random generator functions for a selection of the
standard probability distributions.</caption>
<thead>
<tr class="header">
<th align="right">Probability dist.</th>
<th align="right">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">Beta</td>
<td align="right"><code>rbeta(n, shape1, shape2)</code></td>
</tr>
<tr class="even">
<td align="right">Binomial</td>
<td align="right"><code>rbinom(n, size, prob)</code></td>
</tr>
<tr class="odd">
<td align="right">Chi-squared</td>
<td align="right"><code>rchisq(n, df)</code></td>
</tr>
<tr class="even">
<td align="right">Exponential</td>
<td align="right"><code>rexp(n, rate)</code></td>
</tr>
<tr class="odd">
<td align="right">Gamma</td>
<td align="right"><code>rgamma(n, shape, rate)</code></td>
</tr>
<tr class="even">
<td align="right">Normal</td>
<td align="right"><code>rnorm(n, mean, sd)</code></td>
</tr>
<tr class="odd">
<td align="right">Poisson</td>
<td align="right"><code>rpois(n, lambda)</code></td>
</tr>
<tr class="even">
<td align="right">Student-t</td>
<td align="right"><code>rt(n, df)</code></td>
</tr>
<tr class="odd">
<td align="right">Uniform</td>
<td align="right"><code>runif(n, min, max)</code></td>
</tr>
</tbody>
</table>
<p>To begin experimenting with these functions, look at the following two
webpages:</p>
<p><a href="http://nemeth.shinyapps.io/rnorm" class="uri">http://nemeth.shinyapps.io/rnorm</a></p>
<p><a href="http://nemeth.shinyapps.io/rbinom" class="uri">http://nemeth.shinyapps.io/rbinom</a></p>
<p>On each of these pages you can adjust the parameters of the random
functions and see the results instantly. Note these webpages are Shiny
Apps which are simple to create in RStudio. We will meet these again
later in the course.</p>
<p>So to directly simulate random values in R:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="loops-sim.html#cb455-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb455-2"><a href="loops-sim.html#cb455-2" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>##  [1]  0.01593416  0.17485484 -0.61743859  1.68082666 -0.86537503  0.88374391
##  [7]  1.16457391  0.05594423 -1.17949905 -1.63178444</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="loops-sim.html#cb457-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(x))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="images/rnorm10-1.png" width="50%" /></p>
<p>If you rerun these two commands repeatedly you will notice that the <span class="math inline">\(10\)</span>
values you draw each time changes.</p>
<p>Again, every distribution will have its own parameters that you can
tweak. Try to play around with the following code:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="loops-sim.html#cb459-1" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb459-2"><a href="loops-sim.html#cb459-2" tabindex="-1"></a>  <span class="at">Normal =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">5</span>),</span>
<span id="cb459-3"><a href="loops-sim.html#cb459-3" tabindex="-1"></a>  <span class="at">Poisson =</span> <span class="fu">rpois</span>(<span class="dv">1000</span>, <span class="at">lambda =</span> <span class="dv">1</span>),</span>
<span id="cb459-4"><a href="loops-sim.html#cb459-4" tabindex="-1"></a>  <span class="at">Binomial =</span> <span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.3</span>),</span>
<span id="cb459-5"><a href="loops-sim.html#cb459-5" tabindex="-1"></a>  <span class="at">Exponential =</span> <span class="fu">rexp</span>(<span class="dv">1000</span>, <span class="at">rate =</span> <span class="dv">1</span>)</span>
<span id="cb459-6"><a href="loops-sim.html#cb459-6" tabindex="-1"></a>)</span>
<span id="cb459-7"><a href="loops-sim.html#cb459-7" tabindex="-1"></a></span>
<span id="cb459-8"><a href="loops-sim.html#cb459-8" tabindex="-1"></a><span class="co"># Convert data from wide to long format</span></span>
<span id="cb459-9"><a href="loops-sim.html#cb459-9" tabindex="-1"></a>dist_long <span class="ot">&lt;-</span> dist <span class="sc">%&gt;%</span> </span>
<span id="cb459-10"><a href="loops-sim.html#cb459-10" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;Distribution&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb459-11"><a href="loops-sim.html#cb459-11" tabindex="-1"></a></span>
<span id="cb459-12"><a href="loops-sim.html#cb459-12" tabindex="-1"></a><span class="co"># Create the ggplot</span></span>
<span id="cb459-13"><a href="loops-sim.html#cb459-13" tabindex="-1"></a><span class="fu">ggplot</span>(dist_long, <span class="fu">aes</span>(<span class="at">x =</span> Value)) <span class="sc">+</span></span>
<span id="cb459-14"><a href="loops-sim.html#cb459-14" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb459-15"><a href="loops-sim.html#cb459-15" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Distribution, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb459-16"><a href="loops-sim.html#cb459-16" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb459-17"><a href="loops-sim.html#cb459-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Value&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Sampling Distributions in R&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-200-1.png" width="50%" /></p>
<p><strong>Side note</strong>. Something new we have never seen. The line of code with
<code>pivot_longer</code> is transforming wide format data into long format. In
wide format, each variable forms a column, and each of the columns is of
equal “interest”, so the dataframe is shorter and wider. Try to print
both <code>dist</code> and <code>dist_long</code>. In long format, each row is a unique
observation identified by a value of interest, and a <em>name</em> that
identifies it, a key. The pivot_longer function essentially takes
multiple columns and collapses them into key-value pairs, thereby making
the data longer. In our chunk, the function <code>everything()</code> is used to
select all columns in the data frame. The <code>names_to = "Distribution"</code>
argument is specifying that the names of the original columns should
form a new column called “Distribution”. Similarly,
<code>values_to = "Value"</code> is indicating that the values from the original
columns should form a new column called “Value”. So, after this
transformation, your data frame data_long will have two columns: one for
the type of distribution and one for the corresponding value. This long
format is particularly useful for creating faceted plots with <code>ggplot2</code>
as the plot display will separate, label, colour and arrange your
variables automagically.</p>
<p>Also, you may have noticed that all of the random functions start with
<code>r</code> and follow with an abbreviation of the distribution name. Replacing
<code>r</code> with <code>d</code>, <code>p</code>, <code>q</code> will give you the names of the functions that
allow you to calculate density values, cumulative probabilities, and
quantiles, respectively.</p>
</div>
<div id="repeating-your-simulation" class="section level3 hasAnchor" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> Repeating your simulation<a href="loops-sim.html#repeating-your-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The numbers produced by <code>rnorm()</code>, <code>rbinom()</code>, and the other <code>r...</code>
functions are actually <em>pseudo</em>-random numbers. They are random enough
rather than genuinely random.</p>
<p>The state of the random generator is controlled by the object
<code>.Random.seed</code> which contains a list of integers:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="loops-sim.html#cb460-1" tabindex="-1"></a><span class="co"># next 3 values to be used by the random generator</span></span>
<span id="cb460-2"><a href="loops-sim.html#cb460-2" tabindex="-1"></a>.Random.seed[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1]      10403         32 1260197148</code></pre>
<p>Whenever <code>sample()</code> or an <code>r</code> function is run, the current state of
<code>.Random.seed</code> is used.</p>
<p>In order to re-run a simulation, we need to control the starting point
of <code>.Random.seed</code> this can be done via <code>set.seed()</code> like so:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="loops-sim.html#cb462-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4578</span>)</span>
<span id="cb462-2"><a href="loops-sim.html#cb462-2" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] -0.3906706 -1.8656330 -0.2399937 -0.8530353</code></pre>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="loops-sim.html#cb464-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] -1.1927956  0.3692942 -1.4857336 -0.3040490</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="loops-sim.html#cb466-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4578</span>)</span>
<span id="cb466-2"><a href="loops-sim.html#cb466-2" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -0.3906706 -1.8656330</code></pre>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="loops-sim.html#cb468-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] -0.2399937 -0.8530353</code></pre>
<p>You would typically set your seed when you are performing simulations
and wish to make your work reproducible. This allows others to rerun
your code on their computers and obtain the same results. Without
setting our seeds to be the same, even if we run the same code, the
numbers we would generate would be different.</p>
</div>
<div id="densities" class="section level3 hasAnchor" number="3.4.6">
<h3><span class="header-section-number">3.4.6</span> Densities<a href="loops-sim.html#densities" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The density function is probably the least used in practice out of the
four function types. But if, for instance, you wanted to draw a
probability distribution, such as the normal distribution then it could
be quickly done like this:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="loops-sim.html#cb470-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb470-2"><a href="loops-sim.html#cb470-2" tabindex="-1"></a>dn <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x)</span>
<span id="cb470-3"><a href="loops-sim.html#cb470-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(x)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(x,dn))</span></code></pre></div>
<p><img src="images/dnorm-1.png" width="70%" /></p>
<p>For discrete distributions, where variables can only take distinct
values, it is more appropriate to draw a bar chart rather than a
continuous line. Here is a binomial distribution with <span class="math inline">\(size=10\)</span> and
<span class="math inline">\(p=0.33\)</span>:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="loops-sim.html#cb471-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb471-2"><a href="loops-sim.html#cb471-2" tabindex="-1"></a>binom <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x,</span>
<span id="cb471-3"><a href="loops-sim.html#cb471-3" tabindex="-1"></a>                    <span class="at">db =</span> <span class="fu">dbinom</span>(x, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fl">0.33</span>))</span>
<span id="cb471-4"><a href="loops-sim.html#cb471-4" tabindex="-1"></a><span class="fu">ggplot</span>(binom, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(x), <span class="at">y =</span> db)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="images/dbinom-1.png" width="70%" /></p>
</div>
<div id="probabilities" class="section level3 hasAnchor" number="3.4.7">
<h3><span class="header-section-number">3.4.7</span> Probabilities<a href="loops-sim.html#probabilities" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>pnorm()</code> and <code>pbinom()</code> functions can be used to calculate
probabilities. For example, to calculate the probability of observing
<span class="math inline">\(X\)</span> being less than 2 when <span class="math inline">\(X\)</span> is said to follow a standard normal
distribution: <span class="math display">\[
\text{Pr}(X \leq 2) ~~~\text{where}~~~ X \sim \text{Normal}(0, 1),
\]</span> we would use <code>pnorm()</code> such that</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="loops-sim.html#cb472-1" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.9772499</code></pre>
<p>Similarly, to calculate the probability of flipping a coin ten times and
observing <em>at least</em> 3 heads:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="loops-sim.html#cb474-1" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pbinom</span>(<span class="dv">2</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.9453125</code></pre>
<p>The <code>p</code> functions compute the probability for a given number or vector
of numbers. These functions also goes by the ominous title of the
“Cumulative Distribution Function”. This is because the word
<em>cumulative</em> refers to the fact that we always calculate the probability
of less than or equal to our number occurring.</p>
<p>When you carry out statistical tests such as a t-test or chi-sqaured
test, once you have calculated your summary statistic, you can then use
<code>pt()</code> or <code>pchisq()</code>, respectively, to calculate your <span class="math inline">\(p\)</span>-value. As
performing these tests is a common practice in statistics we obviously
have functions that will do all of this for us (namely <code>t.test()</code> and
<code>chisq.test()</code>, but inside these functions they are using these <code>p...()</code>
functions.</p>
<p>Also note that when calculating <span class="math inline">\(p\)</span>-values when you want the upper tail
(which is most of the time) it is better practice to code:</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="loops-sim.html#cb476-1" tabindex="-1"></a><span class="fu">pbinom</span>(<span class="dv">2</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fl">0.5</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 0.9453125</code></pre>
<p>This is because the <code>lower.tail</code> option is better at handling cases at
the extremes of the distributions.</p>
</div>
<div id="quantiles" class="section level3 hasAnchor" number="3.4.8">
<h3><span class="header-section-number">3.4.8</span> Quantiles<a href="loops-sim.html#quantiles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The quantile functions are the opposite to the probability functions. To
use <code>qnorm()</code> we have to specify a probability, and it will return the
corresponding value of <span class="math inline">\(X\)</span>:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="loops-sim.html#cb478-1" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.975</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1.959964</code></pre>
<p>To rewrite this mathematically: <span class="math display">\[
\text{Pr}(X \leq 1.96) = 0.975 ~~~\text{where}~~~ X \sim \text{Normal}(0, 1).
\]</span></p>
<p>Similarly, if we let <span class="math inline">\(Z \sim \text{Normal}(1, 9)\)</span>. To find the value <span class="math inline">\(q\)</span>
(quantile) such that Pr<span class="math inline">\((Z \leq q)\)</span> is <span class="math inline">\(0.05\)</span> type:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="loops-sim.html#cb480-1" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.05</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">9</span>))</span></code></pre></div>
<pre><code>## [1] -3.934561</code></pre>
<p>These functions also take a vector of quantiles. For example to find
Pr<span class="math inline">\((Z \leq -3.9)\)</span>, Pr<span class="math inline">\((Z \leq 0)\)</span>, and Pr<span class="math inline">\((Z \leq 7)\)</span> type:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="loops-sim.html#cb482-1" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.9</span>, <span class="dv">0</span>, <span class="dv">7</span>)</span>
<span id="cb482-2"><a href="loops-sim.html#cb482-2" tabindex="-1"></a><span class="fu">pnorm</span>(q, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">9</span>))</span></code></pre></div>
<pre><code>## [1] 0.05119945 0.36944134 0.97724987</code></pre>
</div>
<div id="summary-4" class="section level3 hasAnchor" number="3.4.9">
<h3><span class="header-section-number">3.4.9</span> Summary<a href="loops-sim.html#summary-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Simulation is the process of using a computer to generate random
numbers to create data. We can simulate data from discrete and
continuous probability distributions.</p></li>
<li><p>R provides functions for generating random numbers from the common
probability distributions. All functions return a vector of <code>n</code>
realisations. Table <a href="loops-sim.html#tab:rfunc">3.1</a> contains a list of some these
functions. Note that R does not necessarily use the same
parameterisation for these probability distributions as you will see
in your courses, or in popular stats text books. Therefore always
check the help page of the function to confirm its particular
parameterisation.</p></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="loops-sim.html#cb484-1" tabindex="-1"></a><span class="co"># simulate 10 unbiased-coin flips</span></span>
<span id="cb484-2"><a href="loops-sim.html#cb484-2" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>##  [1] 0 0 1 0 0 0 0 0 0 1</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="loops-sim.html#cb486-1" tabindex="-1"></a><span class="co"># simulate total number of heads for 2 trials</span></span>
<span id="cb486-2"><a href="loops-sim.html#cb486-2" tabindex="-1"></a><span class="co"># of 100 unbiased-coin flips</span></span>
<span id="cb486-3"><a href="loops-sim.html#cb486-3" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="dv">2</span>, <span class="dv">100</span>, <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 46 46</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="loops-sim.html#cb488-1" tabindex="-1"></a><span class="co"># draw from 5 values from a standard normal distribution</span></span>
<span id="cb488-2"><a href="loops-sim.html#cb488-2" tabindex="-1"></a><span class="co"># Standard normal distribution N(0,1^2)</span></span>
<span id="cb488-3"><a href="loops-sim.html#cb488-3" tabindex="-1"></a><span class="co"># mean = 0 and standard deviation = 1</span></span>
<span id="cb488-4"><a href="loops-sim.html#cb488-4" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] -0.1047152  0.9304077  1.4534803 -0.9740542 -0.4645038</code></pre>
<ul>
<li><p>To ensure your simulations are reproducible use <code>set.seed()</code> to
specify a starting point for the random number generator.</p></li>
<li><p>The first letter of all the functions in Table <a href="loops-sim.html#tab:rfunc">3.1</a> is
<code>r</code> which stands for “random”. For each probability distribution
there are also density (<code>d</code>), quantile (<code>q</code>), and cumulative
probability functions (<code>p</code>).</p></li>
</ul>
<p>For example, say, <span class="math inline">\(X \sim \text{Normal}(6, 5)\)</span>, then to calculate the
probability that we observe <span class="math inline">\(x\)</span> being less than or equal to <span class="math inline">\(3\)</span>,
<span class="math inline">\(\text{Pr}(X \leq 3)\)</span>:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="loops-sim.html#cb490-1" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## [1] 0.08985625</code></pre>
<p>Similarly, if we wanted to calculate what quantile, <span class="math inline">\(q\)</span>, of <span class="math inline">\(X\)</span> would
correspond to the following: <span class="math display">\[
\text{Pr}(X \leq q) = 0.975
\]</span> then we would use the following command:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="loops-sim.html#cb492-1" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.975</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## [1] 10.38261</code></pre>
</div>
<div id="exercises-5" class="section level3 hasAnchor" number="3.4.10">
<h3><span class="header-section-number">3.4.10</span> Exercises<a href="loops-sim.html#exercises-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Generate some random data and calculate quantile summary statistics:</li>
</ol>
<!-- -->
<ol style="list-style-type: lower-alpha">
<li>Set your seed to be <code>59810</code>.</li>
<li>Simulate 100 values from a random normal distribution with mean 25
and standard deviation 8. Store these in a vector.</li>
<li>Use <code>quantile()</code> to calculate the 25% and 75% quantiles for your
vectors.</li>
<li>Compare these against the 0.25 and 0.75 quantiles calculated using
<code>qnorm()</code>.</li>
</ol>
<ul>
<li>Note that differences in quantile values are due to your vector
containing randomly simulated values.</li>
<li>Quantiles from <code>qnorm()</code> should be 19.60408
and 30.39592.</li>
<li>Quantiles from your vector should be
19.20686 and
31.50523.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Play with random generator functions for other probability
distributions:</li>
</ol>
<ul>
<li><a href="http://nemeth.shinyapps.io/rchisq" class="uri">http://nemeth.shinyapps.io/rchisq</a></li>
<li><a href="http://nemeth.shinyapps.io/rgamma" class="uri">http://nemeth.shinyapps.io/rgamma</a></li>
<li><a href="http://nemeth.shinyapps.io/rexp" class="uri">http://nemeth.shinyapps.io/rexp</a></li>
</ul>
</div>
</div>
<div id="combining-loops-and-simulation" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Combining Loops and Simulation<a href="loops-sim.html#combining-loops-and-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The population model discussed in the Section <a href="loops-sim.html#loops">3.2</a> is considered
to be a deterministic model as there is no random variation, it is
simply a set of equations we evaluate at each time point. What we can do
is give this model a random component. We do this by changing the way we
think about individuals in the population. For example, instead of
saying 0.24 of females produce an offspring, we know say each female has
a probability of 0.24 of producing an offspring. So, the deterministic
model looked like this:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="loops-sim.html#cb494-1" tabindex="-1"></a><span class="co"># time period</span></span>
<span id="cb494-2"><a href="loops-sim.html#cb494-2" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb494-3"><a href="loops-sim.html#cb494-3" tabindex="-1"></a></span>
<span id="cb494-4"><a href="loops-sim.html#cb494-4" tabindex="-1"></a><span class="co"># constants</span></span>
<span id="cb494-5"><a href="loops-sim.html#cb494-5" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.11</span></span>
<span id="cb494-6"><a href="loops-sim.html#cb494-6" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.71</span></span>
<span id="cb494-7"><a href="loops-sim.html#cb494-7" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fl">0.94</span></span>
<span id="cb494-8"><a href="loops-sim.html#cb494-8" tabindex="-1"></a>f  <span class="ot">&lt;-</span> <span class="fl">0.24</span></span>
<span id="cb494-9"><a href="loops-sim.html#cb494-9" tabindex="-1"></a></span>
<span id="cb494-10"><a href="loops-sim.html#cb494-10" tabindex="-1"></a><span class="co"># initial population sizes</span></span>
<span id="cb494-11"><a href="loops-sim.html#cb494-11" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="dv">1200</span></span>
<span id="cb494-12"><a href="loops-sim.html#cb494-12" tabindex="-1"></a>S <span class="ot">&lt;-</span>  <span class="dv">800</span></span>
<span id="cb494-13"><a href="loops-sim.html#cb494-13" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb494-14"><a href="loops-sim.html#cb494-14" tabindex="-1"></a></span>
<span id="cb494-15"><a href="loops-sim.html#cb494-15" tabindex="-1"></a><span class="co"># population growth model</span></span>
<span id="cb494-16"><a href="loops-sim.html#cb494-16" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>years) {</span>
<span id="cb494-17"><a href="loops-sim.html#cb494-17" tabindex="-1"></a>    S[t] <span class="ot">&lt;-</span> p0 <span class="sc">*</span> J[t<span class="dv">-1</span>]</span>
<span id="cb494-18"><a href="loops-sim.html#cb494-18" tabindex="-1"></a>    A[t] <span class="ot">&lt;-</span> p1 <span class="sc">*</span> S[t<span class="dv">-1</span>] <span class="sc">+</span> p2 <span class="sc">*</span> A[t<span class="dv">-1</span>]</span>
<span id="cb494-19"><a href="loops-sim.html#cb494-19" tabindex="-1"></a>    J[t] <span class="ot">&lt;-</span> f <span class="sc">*</span> A[t<span class="dv">-1</span>]</span>
<span id="cb494-20"><a href="loops-sim.html#cb494-20" tabindex="-1"></a>}</span>
<span id="cb494-21"><a href="loops-sim.html#cb494-21" tabindex="-1"></a></span>
<span id="cb494-22"><a href="loops-sim.html#cb494-22" tabindex="-1"></a><span class="co"># store the results</span></span>
<span id="cb494-23"><a href="loops-sim.html#cb494-23" tabindex="-1"></a>owl_pop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb494-24"><a href="loops-sim.html#cb494-24" tabindex="-1"></a>    <span class="at">time  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>years, <span class="dv">3</span>),</span>
<span id="cb494-25"><a href="loops-sim.html#cb494-25" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;J&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;A&quot;</span>), <span class="at">each =</span> years),</span>
<span id="cb494-26"><a href="loops-sim.html#cb494-26" tabindex="-1"></a>    <span class="at">size  =</span> <span class="fu">c</span>(J, S, A)</span>
<span id="cb494-27"><a href="loops-sim.html#cb494-27" tabindex="-1"></a>)</span>
<span id="cb494-28"><a href="loops-sim.html#cb494-28" tabindex="-1"></a></span>
<span id="cb494-29"><a href="loops-sim.html#cb494-29" tabindex="-1"></a><span class="co"># plot the results</span></span>
<span id="cb494-30"><a href="loops-sim.html#cb494-30" tabindex="-1"></a><span class="fu">ggplot</span>(owl_pop) <span class="sc">+</span></span>
<span id="cb494-31"><a href="loops-sim.html#cb494-31" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> size, <span class="at">colour =</span> group, <span class="at">linetype =</span> group)) <span class="sc">+</span></span>
<span id="cb494-32"><a href="loops-sim.html#cb494-32" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>Essentially, we want to replace the deterministic equations in the for
loop with calls to <code>rbinom()</code>. For example, for the subadult population,
at each iteration we want to simulate one binomial sample with a size of
<code>J[t]</code> with probability of success equal to <code>p0</code>.</p>
<p>Make these changes, and rerun the whole script. If you repeatedly rerun
the script you will generate slight variations on the plot, this is due
to the random component. Finally, set your seed to <code>87856</code>, rerun your
script, and check if the plot you produce matches Figure
<a href="loops-sim.html#fig:rnd-owl">3.3</a>.</p>
<div class="figure"><span style="display:block;" id="fig:rnd-owl"></span>
<img src="images/rnd-owl-1.png" alt="Stochastic population growth model over the next 20 years for the Northern spotted owls. Random seed was set to 87856." width="70%" />
<p class="caption">
Figure 3.3: Stochastic population growth model over the next 20 years for the Northern spotted owls. Random seed was set to 87856.
</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>The condition statements in <code>if</code> brackets are logical comparisons
that return a single <code>TRUE</code> or <code>FALSE</code>. The <code>else if</code> and <code>else</code>
portions are optional, and will only be considered if previous
conditional statements have all returned <code>FALSE</code>.<a href="loops-sim.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>Without knowing anything about each child, we assume that they all
have the same probability of obtaining a grade C or above. In
reality, even knowing a child’s gender means that we can start to
adjust this probability. With females being more likely to obtain a
grade C or above than males. <a href="https://www.theguardian.com/news/datablog/2014/aug/21/gcse-results-2014-the-full-breakdown" class="uri">https://www.theguardian.com/news/datablog/2014/aug/21/gcse-results-2014-the-full-breakdown</a>.<a href="loops-sim.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="time.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="string.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
