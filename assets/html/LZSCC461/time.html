<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Time manipulation, aggregation and summarisation | Lancaster University Leipzig LZSCC.461 R Programming</title>
  <meta name="description" content="2 Time manipulation, aggregation and summarisation | Lancaster University Leipzig LZSCC.461 R Programming" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Time manipulation, aggregation and summarisation | Lancaster University Leipzig LZSCC.461 R Programming" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Time manipulation, aggregation and summarisation | Lancaster University Leipzig LZSCC.461 R Programming" />
  
  
  

<meta name="author" content="Lecturer: Robert Lösch" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="read-plot.html"/>
<link rel="next" href="loops-sim.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="libs/detect-resize-0.5.3/jquery.resize.js"></script>
<link href="libs/jquery-ui-1.11.4/jquery-ui.min.css" rel="stylesheet" />
<script src="libs/jquery-ui-1.11.4/jquery-ui.min.js"></script>
<script src="libs/d3-3.5.2/d3.min.js"></script>
<script src="libs/vega-1.4.3/vega.min.js"></script>
<script src="libs/lodash-4.17.21/lodash.min.js"></script>
<script>var lodash = _.noConflict();</script>
<link href="libs/ggvis-0.4.9/css/ggvis.css" rel="stylesheet" />
<script src="libs/ggvis-0.4.9/js/ggvis.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><strong>0</strong> Introduction to R</a>
<ul>
<li class="chapter" data-level="0.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#background"><i class="fa fa-check"></i><b>0.1</b> Background</a></li>
<li class="chapter" data-level="0.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-your-work"><i class="fa fa-check"></i><b>0.2</b> Saving your work</a></li>
<li class="chapter" data-level="0.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started"><i class="fa fa-check"></i><b>0.3</b> Getting started</a></li>
<li class="chapter" data-level="0.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#s:0help"><i class="fa fa-check"></i><b>0.4</b> Getting Help</a></li>
<li class="chapter" data-level="0.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-scripts"><i class="fa fa-check"></i><b>0.5</b> R scripts</a></li>
<li class="chapter" data-level="0.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-markdown"><i class="fa fa-check"></i><b>0.6</b> R Markdown</a></li>
<li class="chapter" data-level="0.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>0.7</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="read-plot.html"><a href="read-plot.html"><i class="fa fa-check"></i><b>1</b> Data manipulation and plotting in R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="read-plot.html"><a href="read-plot.html#before-getting-started"><i class="fa fa-check"></i><b>1.1</b> Before getting started</a></li>
<li class="chapter" data-level="1.2" data-path="read-plot.html"><a href="read-plot.html#working-with-data-in-modern-r"><i class="fa fa-check"></i><b>1.2</b> Working with data in modern R</a></li>
<li class="chapter" data-level="1.3" data-path="read-plot.html"><a href="read-plot.html#data-types"><i class="fa fa-check"></i><b>1.3</b> Data Types</a></li>
<li class="chapter" data-level="1.4" data-path="read-plot.html"><a href="read-plot.html#logical-comparisons-and-boolean-operations"><i class="fa fa-check"></i><b>1.4</b> Logical comparisons and Boolean operations</a></li>
<li class="chapter" data-level="1.5" data-path="read-plot.html"><a href="read-plot.html#plots"><i class="fa fa-check"></i><b>1.5</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>2</b> Time manipulation, aggregation and summarisation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="time.html"><a href="time.html#from-last-week"><i class="fa fa-check"></i><b>2.1</b> From last week</a></li>
<li class="chapter" data-level="2.2" data-path="time.html"><a href="time.html#dates-and-timestamps-in-r"><i class="fa fa-check"></i><b>2.2</b> Dates and timestamps in R</a></li>
<li class="chapter" data-level="2.3" data-path="time.html"><a href="time.html#summarising-data-over-time"><i class="fa fa-check"></i><b>2.3</b> Summarising data over time</a></li>
<li class="chapter" data-level="2.4" data-path="time.html"><a href="time.html#a-timestamp-split-over-several-columns"><i class="fa fa-check"></i><b>2.4</b> A timestamp split over several columns</a></li>
<li class="chapter" data-level="2.5" data-path="time.html"><a href="time.html#time-zones"><i class="fa fa-check"></i><b>2.5</b> Time zones</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="loops-sim.html"><a href="loops-sim.html"><i class="fa fa-check"></i><b>3</b> Loops, Conditional Statements, and Simulation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="loops-sim.html"><a href="loops-sim.html#before-you-start"><i class="fa fa-check"></i><b>3.1</b> Before you start</a></li>
<li class="chapter" data-level="3.2" data-path="loops-sim.html"><a href="loops-sim.html#loops"><i class="fa fa-check"></i><b>3.2</b> Loops</a></li>
<li class="chapter" data-level="3.3" data-path="loops-sim.html"><a href="loops-sim.html#conditional-statements"><i class="fa fa-check"></i><b>3.3</b> Conditional statements</a></li>
<li class="chapter" data-level="3.4" data-path="loops-sim.html"><a href="loops-sim.html#probability-and-simulation"><i class="fa fa-check"></i><b>3.4</b> Probability and Simulation</a></li>
<li class="chapter" data-level="3.5" data-path="loops-sim.html"><a href="loops-sim.html#combining-loops-and-simulation"><i class="fa fa-check"></i><b>3.5</b> Combining Loops and Simulation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>4</b> String processing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="string.html"><a href="string.html#preamble"><i class="fa fa-check"></i><b>4.1</b> Preamble</a></li>
<li class="chapter" data-level="4.2" data-path="string.html"><a href="string.html#introducing-regular-expressions"><i class="fa fa-check"></i><b>4.2</b> Introducing regular expressions</a></li>
<li class="chapter" data-level="4.3" data-path="string.html"><a href="string.html#working-with-strings-and-regular-expressions"><i class="fa fa-check"></i><b>4.3</b> Working with strings and regular expressions</a></li>
<li class="chapter" data-level="4.4" data-path="string.html"><a href="string.html#string-exercises"><i class="fa fa-check"></i><b>4.4</b> String Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="web-app.html"><a href="web-app.html"><i class="fa fa-check"></i><b>5</b> Web scraping, interactive graphics, Shiny Apps, package building, and more</a>
<ul>
<li class="chapter" data-level="5.1" data-path="web-app.html"><a href="web-app.html#packages"><i class="fa fa-check"></i><b>5.1</b> Packages</a></li>
<li class="chapter" data-level="5.2" data-path="web-app.html"><a href="web-app.html#collecting-data"><i class="fa fa-check"></i><b>5.2</b> Collecting data</a></li>
<li class="chapter" data-level="5.3" data-path="web-app.html"><a href="web-app.html#alternative-graphics"><i class="fa fa-check"></i><b>5.3</b> Alternative graphics</a></li>
<li class="chapter" data-level="5.4" data-path="web-app.html"><a href="web-app.html#shiny-web-applications"><i class="fa fa-check"></i><b>5.4</b> Shiny Web Applications</a></li>
<li class="chapter" data-level="5.5" data-path="web-app.html"><a href="web-app.html#rmarkdown-html-notebooks-and-ipythonjupyter-notebooks"><i class="fa fa-check"></i><b>5.5</b> Rmarkdown HTML notebooks and Ipython/Jupyter notebooks</a></li>
<li class="chapter" data-level="5.6" data-path="web-app.html"><a href="web-app.html#exercise-housing-in-nairobi"><i class="fa fa-check"></i><b>5.6</b> Exercise: Housing in Nairobi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i>Further reading</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lancaster University Leipzig LZSCC.461 R Programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Time manipulation, aggregation and summarisation<a href="time.html#time" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="from-last-week" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> From last week<a href="time.html#from-last-week" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Revise the Summary sections in previous chapters.</li>
<li>As usual, to save the code you write for this week, create new R or
Rmd scripts in your R programming folder.</li>
<li>Write a few introductory comments at the top stating that this
script covers the basics handling dates and times in R, along with
how to aggregate and summarise data.</li>
<li>Add your favourite packages to the start of your script:</li>
</ul>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="time.html#cb303-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="dates-and-timestamps-in-r" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Dates and timestamps in R<a href="time.html#dates-and-timestamps-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Date-time data is typically generated by an automated process or system.
See Figures <a href="time.html#fig:dt-example-1">2.1</a>–<a href="time.html#fig:dt-example-2">2.2</a> for
examples.</p>
<div class="figure"><span style="display:block;" id="fig:dt-example-1"></span>
<img src="week3/control_tower.jpg" alt="Air traffic control direct aircraft on the ground and through controlled air space. They prevent collisions and organise the flow of air traffic." width="49%" />
<p class="caption">
Figure 2.1: Air traffic control direct aircraft on the ground and through controlled air space. They prevent collisions and organise the flow of air traffic.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:dt-example-2"></span>
<img src="week3/jogger.jpg" alt="Left: The GPS tracker a runner uses when they go out training continuously logs their location over time; Right: A bank statement is an event-log of transactions." width="45%" /><img src="week3/bank_statement.png" alt="Left: The GPS tracker a runner uses when they go out training continuously logs their location over time; Right: A bank statement is an event-log of transactions." width="54%" />
<p class="caption">
Figure 2.2: Left: The GPS tracker a runner uses when they go out training continuously logs their location over time; Right: A bank statement is an event-log of transactions.
</p>
</div>
<p>Data collected in this fashion can be thought of as an event log, with
one column containing the date and time of the event, and the remaining
columns capturing whatever measures thought necessary.</p>
<p>You may not know this yet, but when working with event-log data, the
date-time component can be very frustrating to work with. To begin with,
a timestamp may take on a variety of forms:</p>
<pre><code>2014/08/12 19:47
2014/12/08 19:47:01
12/08/2014 19:47:01
19:47:01 12/08/2014
7.47PM 12-AUG-14</code></pre>
<p>As you can see timestamps can come in many different formats, which
makes recognising and parsing them a challenge. Will R recognise the
format that we have? If it does, we still face problems specific to
timestamps. How can we easily extract components of the timestamp, such
as the year, month, or number of seconds? How can we switch between time
zones, or compare times from places that use daylight savings time (DST)
with times from places that do not? Handling timestamps becomes even
more complicated when we try to do arithmetic with them. Conventions
such as leap years and DST make it unclear what we mean by “one day from
now” or “exactly two years away”. Even leap seconds can disrupt a
seemingly simple calculation. This complexity affects other tasks too,
such as constructing sensible tick marks for plotting date-time data.</p>
<p>While base R handles some of these problems, the syntax it uses can be
confusing and difficult to remember. Moreover, the correct R code often
changes depending on the <em>type</em> of date-time object being used. This is
exactly why the <code>lubridate</code> package was created; in order to address
these problems and makes it easier to work with date-time data in R. It
also provides tools for manipulating timestamps in novel but useful
ways. Specifically, <code>lubridate</code> helps us to:</p>
<ul>
<li>Identify and parse date-time data;</li>
<li>Extract and modify components of a date-time, such as years, months,
days, hours, minutes, and seconds;</li>
<li>Perform accurate calculations with date-times and time-spans;</li>
<li>Handle time zones and daylight savings time.</li>
</ul>
<p>Before we continue install the <code>lubridate</code> package:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="time.html#cb305-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<p>Now load it.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="time.html#cb306-1" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<div id="parsing-timestamps" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Parsing timestamps<a href="time.html#parsing-timestamps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can parse dates and timestamps in R using the <code>ymd()</code> series of
functions provided by <code>lubridate</code>, these are shown in Table
<a href="time.html#tab:parse">2.1</a>. These functions parse character strings into date-time
objects. The letters <code>y</code>, <code>m</code>, and <code>d</code> in the function names correspond
to the year, month, and day elements of a timestamp. To parse a
timestamp, choose the function name that matches the order of elements
in the timestamp. For example, in the following date the month element
comes first, followed by the day and then the year. So we would use the
<code>mdy()</code> function:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="time.html#cb307-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;12/01/2010&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-01&quot;</code></pre>
<p>The same function can also be used to parse <code>"Dec 1st, 2010"</code>:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="time.html#cb309-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;Dec 1st, 2010&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-01&quot;</code></pre>
<p>The <code>ymd()</code> series of functions can also parse vectors of dates:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="time.html#cb311-1" tabindex="-1"></a><span class="fu">dmy</span>(<span class="fu">c</span>(<span class="st">&quot;31.12.2010&quot;</span>, <span class="st">&quot;01.01.2011&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-31&quot; &quot;2011-01-01&quot;</code></pre>
<p>These functions automatically recognise the separators commonly used to
record dates. These include: <code>-</code>, <code>/</code>, <code>.</code>, and “no separator”. When a
<code>ymd()</code> function is applied to a vector, it assumes that all of the
elements within the vector have the same order and the same separators.</p>
<table>
<caption><span id="tab:parse">Table 2.1: </span> Parse-function names are based on the order that the
year, month, and day appear within the dates to be parsed. Other
variations exist.</caption>
<thead>
<tr class="header">
<th>Order of elements in timestamp</th>
<th>Parse function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>year, month, day</td>
<td><code>ymd()</code></td>
</tr>
<tr class="even">
<td>year, day, month</td>
<td><code>ydm()</code></td>
</tr>
<tr class="odd">
<td>month, day, year</td>
<td><code>mdy()</code></td>
</tr>
<tr class="even">
<td>day, month, year</td>
<td><code>dmy()</code></td>
</tr>
<tr class="odd">
<td>hour, minute</td>
<td><code>hm()</code></td>
</tr>
<tr class="even">
<td>hour, minute, second</td>
<td><code>hms()</code></td>
</tr>
<tr class="odd">
<td>year, month, day, hour, minute, second</td>
<td><code>ymd_hms()</code></td>
</tr>
<tr class="even">
<td>hour, minute, second, day, month, year</td>
<td><code>hms_dmy()</code></td>
</tr>
</tbody>
</table>
</div>
<div id="manipulating-timestamps" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Manipulating timestamps<a href="time.html#manipulating-timestamps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most timestamps include a year value, a month value, a day value and so
on. Together these elements specify the exact moment that an event
occurred or when an observation was made. We can easily extract each
element of a timestamp with the accessor functions listed in Table
<a href="time.html#tab:accessor">2.2</a>. For example, if we save the current system
time:<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="time.html#cb313-1" tabindex="-1"></a>stamp <span class="ot">&lt;-</span> <span class="fu">now</span>()</span>
<span id="cb313-2"><a href="time.html#cb313-2" tabindex="-1"></a><span class="fu">class</span>(stamp)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p>We can then extract each of its elements:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="time.html#cb315-1" tabindex="-1"></a><span class="fu">year</span>(stamp) <span class="co"># for illustration only; your output might vary</span></span></code></pre></div>
<pre><code>## [1] 2024</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="time.html#cb317-1" tabindex="-1"></a><span class="fu">minute</span>(stamp) <span class="co"># your output might vary</span></span></code></pre></div>
<pre><code>## [1] 57</code></pre>
<p>For the month and weekday elements (<code>mday</code> and <code>wday</code>), we can also
specify whether we want to extract the numerical value of the element,
an abbreviation of the name of the month or weekday, or the full name.
For example:</p>
<table>
<caption><span id="tab:accessor">Table 2.2: </span> Each date-time element can be extracted with its own
accessor function.</caption>
<thead>
<tr class="header">
<th>Component</th>
<th>Accessor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Year</td>
<td><code>year()</code></td>
</tr>
<tr class="even">
<td>Month</td>
<td><code>month()</code></td>
</tr>
<tr class="odd">
<td>Week</td>
<td><code>week()</code></td>
</tr>
<tr class="even">
<td>Day of year</td>
<td><code>yday()</code></td>
</tr>
<tr class="odd">
<td>Day of month</td>
<td><code>mday()</code></td>
</tr>
<tr class="even">
<td>Day of week</td>
<td><code>wday()</code></td>
</tr>
<tr class="odd">
<td>Hour</td>
<td><code>hour()</code></td>
</tr>
<tr class="even">
<td>Minute</td>
<td><code>minute()</code></td>
</tr>
<tr class="odd">
<td>Second</td>
<td><code>second()</code></td>
</tr>
<tr class="even">
<td>Time zone</td>
<td><code>tz()</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="time.html#cb319-1" tabindex="-1"></a><span class="fu">month</span>(stamp) <span class="co"># your output might vary</span></span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="time.html#cb321-1" tabindex="-1"></a><span class="fu">month</span>(stamp, <span class="at">label=</span><span class="cn">TRUE</span>) <span class="co"># your output might vary</span></span></code></pre></div>
<pre><code>## [1] Oct
## 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="time.html#cb323-1" tabindex="-1"></a><span class="fu">month</span>(stamp, <span class="at">label=</span><span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>) <span class="co"># your output might vary</span></span></code></pre></div>
<pre><code>## [1] October
## 12 Levels: January &lt; February &lt; March &lt; April &lt; May &lt; June &lt; ... &lt; December</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="time.html#cb325-1" tabindex="-1"></a><span class="fu">wday</span>(stamp, <span class="at">label=</span><span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>) <span class="co"># your output might vary</span></span></code></pre></div>
<pre><code>## [1] Tuesday
## 7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
</div>
<div id="arithmetic-with-timestamps" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Arithmetic with timestamps<a href="time.html#arithmetic-with-timestamps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Arithmetic with timestamps is more complicated than arithmetic with
numbers, but it can be done accurately and easily with <code>lubridate</code>. What
complicates arithmetic with timestamps? Clock times are periodically
re-calibrated to reflect astronomical conditions, such as the hour of
daylight or the Earth’s tilt on its axis relative to the sun. We know
these re-calibrations as <!--daylight savings time,--> leap years and leap
seconds. Consider how one of these conventions might complicate a simple
addition task. If today were January 1st, 2010 and we wished to know
what day it would be one year from now, we could simply add 1 to the
years element of our date:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="time.html#cb327-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;January 1st, 2010&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2011-01-01&quot;</code></pre>
<p>Alternatively, we could add 365 to the days element of our date because
a year is equivalent to 365 days:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="time.html#cb329-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;January 1st, 2010&quot;</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">365</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2011-01-01&quot;</code></pre>
<p>However, problems arise if we try the same for January 1st, 2012. 2012
is a leap year, which means it has an extra day. Our two approaches
above now give us different answers because the length of a year has
changed:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="time.html#cb331-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;January 1st, 2012&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2013-01-01&quot;</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="time.html#cb333-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;January 1st, 2012&quot;</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">365</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2012-12-31&quot;</code></pre>
<p>At different moments in time, the lengths of months, weeks, days, hours,
and even minutes will also vary. We can consider these to be <em>relative</em>
units of time; their length is relative to when they occur. In contrast,
seconds always have a consistent length. Hence, seconds are <em>exact</em>
units of time. Researchers may be interested in exact lengths, relative
lengths, or both. For example, the speed of a physical object is most
precisely measured in exact lengths. The opening bell of the stock
market is more easily modelled with relative lengths.</p>
<p>In general, we can change timestamps by adding or subtracting units of
time from them. To do this use the helper functions; <code>years()</code>,
<code>months()</code>, <code>weeks()</code>, <code>days()</code>, <code>hours()</code>, <code>minutes()</code>, and
<code>seconds()</code>. Where the first and only argument is the amount of that
unit of time:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="time.html#cb335-1" tabindex="-1"></a>stamp <span class="sc">-</span> <span class="fu">hours</span>(<span class="dv">48</span>) <span class="sc">-</span> <span class="fu">minutes</span>(<span class="dv">30</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2024-10-20 12:27:13 CEST&quot;</code></pre>
</div>
<div id="intervals-and-durations" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Intervals and durations<a href="time.html#intervals-and-durations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often we do not want to necessarily <em>change</em> a timestamp, but actually
calculate the difference between two timestamps. For example, between
the start and end of an event to calculate the duration, or to count
down to a particular event. We first define an interval using between
our two time-points:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="time.html#cb337-1" tabindex="-1"></a>halloween <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2014-10-31&quot;</span>)</span>
<span id="cb337-2"><a href="time.html#cb337-2" tabindex="-1"></a>christmas <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2014-12-25&quot;</span>)</span>
<span id="cb337-3"><a href="time.html#cb337-3" tabindex="-1"></a>inter  <span class="ot">&lt;-</span> <span class="fu">interval</span>(halloween, christmas)</span>
<span id="cb337-4"><a href="time.html#cb337-4" tabindex="-1"></a>inter</span></code></pre></div>
<pre><code>## [1] 2014-10-31 UTC--2014-12-25 UTC</code></pre>
<p>After which we can choose to express this interval as a duration in
terms of a specific time-unit (e.g. weeks, days, or seconds):</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="time.html#cb339-1" tabindex="-1"></a>inter <span class="sc">/</span> <span class="fu">dweeks</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 7.857143</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="time.html#cb341-1" tabindex="-1"></a>inter <span class="sc">/</span> <span class="fu">ddays</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="time.html#cb343-1" tabindex="-1"></a>inter <span class="sc">/</span> <span class="fu">dseconds</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 4752000</code></pre>
<p>In order to express an interval as a duration we divide by similar
functions to those used in the arithmetic section but they are all
prefixed with <code>d</code>.</p>
</div>
<div id="unix-time" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Unix time<a href="time.html#unix-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To overcome the issues with relative time, some systems store timestamps
simply as the number of seconds since
<code>00:00:00, Thursday, 1st January 1970 (UTC)</code>. When time is stored like
this it is referred to as Unix-time or time-since-Epoch.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-140"></span>
<img src="week3/celebrate_unix_time.jpg" alt="Unix time passed 1,000,000,000 seconds on 2001-09-09 01:46:40 UTC. It was celebrated in Copenhagen, Denmark at a party (03:46 local time)." width="70%" />
<p class="caption">
Figure 2.3: Unix time passed 1,000,000,000 seconds on 2001-09-09 01:46:40 UTC. It was celebrated in Copenhagen, Denmark at a party (03:46 local time).
</p>
</div>
<p>To convert a date-time object to Unix time, simply change the object
type to numeric:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="time.html#cb345-1" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2001-09-09 01:46:40&quot;</span>, <span class="at">tz=</span><span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb345-2"><a href="time.html#cb345-2" tabindex="-1"></a><span class="fu">as.numeric</span>(event)</span></code></pre></div>
<pre><code>## [1] 1e+09</code></pre>
<p>To convert from Unix-time back to a timestamp, take the Unix-time value
(which is just a number of seconds) and add it to the origin:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="time.html#cb347-1" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;1970-01-01 00:00:00&quot;</span>, <span class="at">tz=</span><span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb347-2"><a href="time.html#cb347-2" tabindex="-1"></a>origin <span class="sc">+</span> <span class="fu">seconds</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>) <span class="co"># 1 billion seconds</span></span></code></pre></div>
<pre><code>## [1] &quot;2001-09-09 01:46:40 UTC&quot;</code></pre>
</div>
<div id="rounding-time" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Rounding time<a href="time.html#rounding-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Like all measurements, timestamps have a precision; they are often
measured to the nearest day, minute, or second. This means that
timestamps can be rounded. To perform this rounding we use:
<code>round_date()</code>, <code>floor_date()</code>, and <code>ceiling_date()</code>. The first argument
of each function is a timestamp or vector of timestamps to be rounded.
The second argument is the unit to round to. For example, we could round
11:33, 20th April 2010 to the nearest day:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="time.html#cb349-1" tabindex="-1"></a>april20 <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-04-20 11:33:29&quot;</span>)</span>
<span id="cb349-2"><a href="time.html#cb349-2" tabindex="-1"></a><span class="fu">round_date</span>(april20, <span class="st">&quot;day&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-04-20 UTC&quot;</code></pre>
<p>Note that rounding a timestamp to a particular day sets the hours,
minutes and seconds components of the timestamp to <span class="math inline">\(00\)</span>. If the
timestamp is in the afternoon then it will be rounded up to the next
day:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="time.html#cb351-1" tabindex="-1"></a>april20 <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-04-20 14:15:02&quot;</span>)</span>
<span id="cb351-2"><a href="time.html#cb351-2" tabindex="-1"></a><span class="fu">round_date</span>(april20, <span class="st">&quot;day&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-04-21 UTC&quot;</code></pre>
<p>Similarly, rounding to the nearest month, sets the day to <span class="math inline">\(01\)</span>
regardless of which month it is rounded to:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="time.html#cb353-1" tabindex="-1"></a><span class="fu">round_date</span>(april20, <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-05-01 UTC&quot;</code></pre>
<p>We can use <code>ceiling_date()</code> to find the last day of a month. Do this by
ceiling a timestamp to the next month and then subtract one day:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="time.html#cb355-1" tabindex="-1"></a><span class="fu">ceiling_date</span>(april20, <span class="st">&quot;month&quot;</span>) <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-04-30 UTC&quot;</code></pre>
</div>
<div id="a-real-example-sea-ice-extent" class="section level3 hasAnchor" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> A Real Example: Sea Ice Extent<a href="time.html#a-real-example-sea-ice-extent" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are now going to put some of this <code>lubridate</code> knowledge into practice
by exploring the data collected as part of the routine monitoring of the
amount of sea ice at the Arctic.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<p>Certain satelites that pass over the Arctic have equipment that allows
them to measure the presence of sea ice and its density. What we are
interested in is the extent of the sea ice i.e. the surface area when
viewed from above. Figure <a href="time.html#fig:extent">2.4</a> shows the extent of the sea
ice in October, 2013.</p>
<div class="figure"><span style="display:block;" id="fig:extent"></span>
<img src="week3/N_201310_extn.png" alt="Extent of the Arctic sea ice in October, 2013. Outline shows the median ice edge." width="70%" />
<p class="caption">
Figure 2.4: Extent of the Arctic sea ice in October, 2013. Outline shows the median ice edge.
</p>
</div>
<ol style="list-style-type: decimal">
<li><p>Download the <code>NH_sea_ice_extent_2014-10-10.csv</code> data set from the
Moodle page into your working directory. Within R, read this into an
object called <code>sea_ice</code> (or similar).</p></li>
<li><p>Use <code>head()</code> to look at the first few rows of <code>sea_ice</code> and parse
the <code>date</code> column accordingly. The <code>extent</code> column is a measure of
the top-down surface area of the sea ice in million
square-kilometres.</p></li>
<li><p>If you use the <code>class()</code> function on <code>sea_ice$date</code> you’ll see that
it’s either of type character or factor (depending upon whether you
set the <code>stringsAsFactors</code> to <code>FALSE</code> or not respectively). We need
to change this so that R recognises that it’s a data. Run the
command below and check the class again</p></li>
</ol>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="time.html#cb357-1" tabindex="-1"></a>sea_ice<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(sea_ice<span class="sc">$</span>date)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Plot the extent of the sea ice over time.</li>
</ol>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="time.html#cb358-1" tabindex="-1"></a><span class="fu">ggplot</span>(sea_ice) <span class="sc">+</span></span>
<span id="cb358-2"><a href="time.html#cb358-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> extent))</span></code></pre></div>
<p><img src="images/sea-ice-time-1.png" width="80%" /></p>
<p>What can be seen here is that while there is clear seasonal variation,
there also appears to be a downward trend over time.</p>
<ol start="5" style="list-style-type: decimal">
<li>To focus on the seasonal variation, we need to create a graphic that
shows <code>extent</code> from January to December on the x-axis, with each
year then having its own line. To do this we first need to create
two extra variables based on <code>date</code>; one which contains the year
component, and the other containing the day of the year (1-365):</li>
</ol>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="time.html#cb359-1" tabindex="-1"></a>sea_ice<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">year</span>(sea_ice<span class="sc">$</span>date)</span>
<span id="cb359-2"><a href="time.html#cb359-2" tabindex="-1"></a>sea_ice<span class="sc">$</span>year_day <span class="ot">&lt;-</span> <span class="fu">yday</span>(sea_ice<span class="sc">$</span>date)</span>
<span id="cb359-3"><a href="time.html#cb359-3" tabindex="-1"></a><span class="fu">head</span>(sea_ice)</span></code></pre></div>
<pre><code>##         date   extent year year_day
## 1 1978-10-26 10.19591 1978      299
## 2 1978-10-28 10.34363 1978      301
## 3 1978-10-30 10.46621 1978      303
## 4 1978-11-01 10.65538 1978      305
## 5 1978-11-03 10.76997 1978      307
## 6 1978-11-05 10.96294 1978      309</code></pre>
<p>Using these two new variables we can now create a seasonal plot. Note
that in order to tell <code>ggplot()</code> to produce a separate line for each
year we specify <code>group = year</code> as part of <code>aes()</code>.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="time.html#cb361-1" tabindex="-1"></a><span class="fu">ggplot</span>(sea_ice) <span class="sc">+</span></span>
<span id="cb361-2"><a href="time.html#cb361-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_day, <span class="at">y =</span> extent, <span class="at">group =</span> year),</span>
<span id="cb361-3"><a href="time.html#cb361-3" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="images/sea-ice-seasonal-1.png" width="80%" /></p>
<p>To highlight which lines belong to which year modify the plot so we
colour each line according to year:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="time.html#cb362-1" tabindex="-1"></a><span class="fu">ggplot</span>(sea_ice) <span class="sc">+</span></span>
<span id="cb362-2"><a href="time.html#cb362-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_day, <span class="at">y =</span> extent, <span class="at">group =</span> year, <span class="at">colour =</span> year),</span>
<span id="cb362-3"><a href="time.html#cb362-3" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb362-4"><a href="time.html#cb362-4" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>To change the colours used for the gradient, and the labels shown on the
colour bar for year, add <code>scale_colour_gradient()</code> to your <code>ggplot()</code>
command:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="time.html#cb363-1" tabindex="-1"></a><span class="fu">ggplot</span>(sea_ice) <span class="sc">+</span></span>
<span id="cb363-2"><a href="time.html#cb363-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_day, <span class="at">y =</span> extent, <span class="at">group =</span> year, <span class="at">colour =</span> year),</span>
<span id="cb363-3"><a href="time.html#cb363-3" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb363-4"><a href="time.html#cb363-4" tabindex="-1"></a>  <span class="fu">scale_colour_gradient</span>(<span class="at">low =</span> <span class="st">&quot;red&quot;</span>, <span class="at">high =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb363-5"><a href="time.html#cb363-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>Try other colours to see if you can find something that looks pretty. An
alternative to picking colours yourself is to use the colour brewer:<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="time.html#cb364-1" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb364-2"><a href="time.html#cb364-2" tabindex="-1"></a>palette <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="at">name =</span> <span class="st">&quot;BrBG&quot;</span>)</span>
<span id="cb364-3"><a href="time.html#cb364-3" tabindex="-1"></a></span>
<span id="cb364-4"><a href="time.html#cb364-4" tabindex="-1"></a><span class="fu">ggplot</span>(sea_ice) <span class="sc">+</span></span>
<span id="cb364-5"><a href="time.html#cb364-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_day, <span class="at">y =</span> extent, <span class="at">group =</span> year, <span class="at">colour =</span> year),</span>
<span id="cb364-6"><a href="time.html#cb364-6" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb364-7"><a href="time.html#cb364-7" tabindex="-1"></a>  <span class="fu">scale_colour_gradient</span>(<span class="at">low =</span> palette[<span class="dv">1</span>], <span class="at">high =</span> palette[<span class="dv">3</span>]) <span class="sc">+</span></span>
<span id="cb364-8"><a href="time.html#cb364-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="images/sea-ice-colorbrewer-1.png" width="50%" /></p>
</div>
</div>
<div id="summarising-data-over-time" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Summarising data over time<a href="time.html#summarising-data-over-time" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When wanting to look at year-on-year trends, we often want to look past
any variation due to seasonality. There are few ways of doing this:</p>
<ul>
<li>Only look at the same time point at each year e.g. numbers for
October every year.</li>
<li>Create an average for a fixed time unit e.g. average per year.</li>
</ul>
<p>We will consider each of these approaches using the R packages we have
covered so far in the course. The first of these is the simplest to
implement, we begin by keeping only October observations:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="time.html#cb365-1" tabindex="-1"></a>sea_ice<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">month</span>(sea_ice<span class="sc">$</span>date)</span>
<span id="cb365-2"><a href="time.html#cb365-2" tabindex="-1"></a>sea_ice_oct <span class="ot">&lt;-</span> sea_ice <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">10</span>)</span>
<span id="cb365-3"><a href="time.html#cb365-3" tabindex="-1"></a><span class="fu">head</span>(sea_ice_oct)</span></code></pre></div>
<pre><code>##         date   extent year year_day month
## 1 1978-10-26 10.19591 1978      299    10
## 2 1978-10-28 10.34363 1978      301    10
## 3 1978-10-30 10.46621 1978      303    10
## 4 1979-10-01  7.36108 1979      274    10
## 5 1979-10-03  7.48100 1979      276    10
## 6 1979-10-05  7.73403 1979      278    10</code></pre>
<p>However, we have more than one observation per month, and they are not
always at the same day within the month. One solution to this is to use
only the first observation for each October, but to do this we need to
work out which one that is. To do this we use <code>group_by()</code> and
<code>summarise()</code> from <code>dplyr</code>.</p>
<div id="aggregating-information-group-by-and-summarise" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Aggregating information: Group by and summarise<a href="time.html#aggregating-information-group-by-and-summarise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to break-up our data frame into small subgroups so that we can
perform the same calculation on each subgroup, we use <code>group_by()</code> from
<code>dplyr</code>, whose first argument is the data frame of interest and all
subsequent arguments are the variables to be grouped on. The following
will create groups for each unique value in <code>year</code>:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="time.html#cb367-1" tabindex="-1"></a>sea_ice_oct_grp <span class="ot">&lt;-</span> sea_ice_oct <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year)</span>
<span id="cb367-2"><a href="time.html#cb367-2" tabindex="-1"></a><span class="fu">is.grouped_df</span>(sea_ice_oct_grp)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code>sea_ice_oct_grp</code> is a grouped data frame. Use <code>ungroup()</code> to remove a
grouping that is no longer needed. To summarise each group we send
<code>sea_ice_oct_grp</code> to the <code>summarise()</code> function which will produce a new
data frame containing the grouping variable (just <code>year</code> in this case)
and any summary variables we decide to calculate:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="time.html#cb369-1" tabindex="-1"></a>oct_summary <span class="ot">&lt;-</span> sea_ice_oct_grp <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb369-2"><a href="time.html#cb369-2" tabindex="-1"></a>  <span class="at">date     =</span> <span class="fu">first</span>(date),</span>
<span id="cb369-3"><a href="time.html#cb369-3" tabindex="-1"></a>  <span class="at">extent   =</span> <span class="fu">first</span>(extent),</span>
<span id="cb369-4"><a href="time.html#cb369-4" tabindex="-1"></a>  <span class="at">year_day =</span> <span class="fu">first</span>(year_day)</span>
<span id="cb369-5"><a href="time.html#cb369-5" tabindex="-1"></a>)</span></code></pre></div>
<p>The code above summaries each group simply by taking the first row in
each subgroup and stores the results in a data frame called
<code>oct_summary</code>. This is, of course, a very crude summary. But it does
give us one observation per October of every year.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="time.html#cb370-1" tabindex="-1"></a><span class="fu">head</span>(oct_summary)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##    year date       extent year_day
##   &lt;dbl&gt; &lt;date&gt;      &lt;dbl&gt;    &lt;dbl&gt;
## 1  1978 1978-10-26  10.2       299
## 2  1979 1979-10-01   7.36      274
## 3  1980 1980-10-01   8.17      275
## 4  1981 1981-10-02   7.94      275
## 5  1982 1982-10-01   7.71      274
## 6  1983 1983-10-02   8.09      275</code></pre>
<p>We see that the extent of the sea ice for the first observation in
October, 1978 as 10.2 million sq-km. Also, we can see that by asking for
the first date, it has now been converted to Unix time. To convert it
back to a timestamp see the section on Unix time.</p>
<p><code>first()</code> is one of the many functions we can use for aggregating data
with the <code>group_by() %&gt;% summarise()</code> combo. As you will see as follows
(and in the exercises) we can do a lot more cool stuff with this
statement:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="time.html#cb372-1" tabindex="-1"></a>oct_summary_2 <span class="ot">&lt;-</span> sea_ice_oct_grp <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb372-2"><a href="time.html#cb372-2" tabindex="-1"></a>  <span class="at">tot_extent =</span> <span class="fu">sum</span>(extent),</span>
<span id="cb372-3"><a href="time.html#cb372-3" tabindex="-1"></a>  <span class="at">len_extent =</span> <span class="fu">n_distinct</span>(extent),</span>
<span id="cb372-4"><a href="time.html#cb372-4" tabindex="-1"></a>  <span class="at">mean_extent_1 =</span> tot_extent <span class="sc">/</span> len_extent,  <span class="co"># equivalent to below</span></span>
<span id="cb372-5"><a href="time.html#cb372-5" tabindex="-1"></a>  <span class="at">mean_extent_2 =</span> <span class="fu">mean</span>(extent),             <span class="co"># equivalent to above</span></span>
<span id="cb372-6"><a href="time.html#cb372-6" tabindex="-1"></a>  <span class="at">sd_extent =</span> <span class="fu">sd</span>(extent)</span>
<span id="cb372-7"><a href="time.html#cb372-7" tabindex="-1"></a>)</span>
<span id="cb372-8"><a href="time.html#cb372-8" tabindex="-1"></a>oct_summary_2</span></code></pre></div>
<pre><code>## # A tibble: 37 × 6
##     year tot_extent len_extent mean_extent_1 mean_extent_2 sd_extent
##    &lt;dbl&gt;      &lt;dbl&gt;      &lt;int&gt;         &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;
##  1  1978       31.0          3         10.3          10.3      0.135
##  2  1979      139.          16          8.70          8.70     0.888
##  3  1980      146.          16          9.14          9.14     0.603
##  4  1981      132.          15          8.81          8.81     0.553
##  5  1982      150.          16          9.37          9.37     0.935
##  6  1983      139.          15          9.27          9.27     0.663
##  7  1984      128.          15          8.52          8.52     0.545
##  8  1985      136.          16          8.50          8.50     0.713
##  9  1986      141.          15          9.43          9.43     0.590
## 10  1987      280.          31          9.02          9.02     0.489
## # ℹ 27 more rows</code></pre>
<p>You can see that the syntax is quite similar to <code>mutate</code>! Have a look at
the second page of the Cheat-Sheet of data-transformation with dplyr
(<a href="https://rstudio.github.io/cheatsheets/html/data-transformation.html#summary-functions">also at this
link</a>).</p>
<div id="exercise-1" class="section level4 hasAnchor" number="2.3.1.1">
<h4><span class="header-section-number">2.3.1.1</span> Exercise<a href="time.html#exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using <code>ggplot()</code> and <code>oct_summary</code>, you should now try to produce a
graph showing the <em>highest</em> extent of the sea ice in October for each
year (shown here in Figure <a href="time.html#fig:ice-october">2.5</a>). Note that previously
we only stored the first observation, so you will need a different
<code>summarise</code> statement.</p>
<div class="figure"><span style="display:block;" id="fig:ice-october"></span>
<img src="images/ice-october-1.png" alt="Ice extent (million sq-km) in October each year. We are plotting the max in October per each year." width="80%" />
<p class="caption">
Figure 2.5: Ice extent (million sq-km) in October each year. We are plotting the max in October per each year.
</p>
</div>
</div>
</div>
<div id="yearly-averages" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Yearly averages<a href="time.html#yearly-averages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="exercise-2" class="section level4 hasAnchor" number="2.3.2.1">
<h4><span class="header-section-number">2.3.2.1</span> Exercise<a href="time.html#exercise-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To calculate the average of a variable in a data frame, we pass the
variable to the <code>mean()</code> function:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="time.html#cb374-1" tabindex="-1"></a><span class="fu">mean</span>(sea_ice<span class="sc">$</span>extent)</span></code></pre></div>
<pre><code>## [1] 11.44243</code></pre>
<p>This calculated the mean across all observations of <code>extent</code>. Repeat the
process of grouping and summarising on the whole dataset, grouping by
year. And instead of capturing the first observation, calculate the mean
of the extent observations within each group. Thus you will be able to
visualise change in yearly-average of ice extent over time. The graph
you produce should look like Figure <a href="time.html#fig:ice-yearly">2.6</a>.</p>
<div class="figure"><span style="display:block;" id="fig:ice-yearly"></span>
<img src="images/ice-yearly-1.png" alt="Average ice extent (million sq-km) for each year. Note the difference in scale on the y-axis between the October graph and this yearly graph. Look back at seasonal variation to understand the cause for the difference." width="80%" />
<p class="caption">
Figure 2.6: Average ice extent (million sq-km) for each year. Note the difference in scale on the y-axis between the October graph and this yearly graph. Look back at seasonal variation to understand the cause for the difference.
</p>
</div>
<!-- ### Moving average -->
<!-- So far, to get past the seasonal variation, we have averaged over -->
<!-- distinct subsets of data. An alternative to this is to average over a moving -->
<!-- window of the data, this type of average is called a moving or rolling average. -->
<!-- At each observation, we use it and the previous, say, 12 months of observations -->
<!-- to calculate an average. We then move on to the next observation and then -->
<!-- calculate its average based on its previous 12 months. This process -->
<!-- runs until we reach the last row in our data, but only starts -->
<!-- once we have at least 12 months of data: -->
<!-- ```{r} -->
<!-- min(sea_ice$date) + months(12) -->
<!-- ``` -->
<!-- This would be the first time point at which our average is calculated. -->
<!-- To calculate the moving average, we iterate over the rows in `sea_ice` -->
<!-- using a `for` loop: -->
<!-- ```{r, eval=FALSE} -->
<!-- for (i in 1:nrow(sea_ice)) { -->
<!--     # ... moving average code ... -->
<!-- } -->
<!-- ``` -->
<!-- There are several steps we need to take in order to calculate the -->
<!-- moving average. For each row we need to: -->
<!-- * Identify if we can start calculating the average yet. -->
<!-- * Identify the 12-month subset. -->
<!-- * Calculate and store the average for this subset. -->
<!-- Note that once you execute the code below, it will take a while to finish, as -->
<!-- looping is a slow process in R, and we have a lot of rows to loop over: -->
<!-- ```{r cache=TRUE} -->
<!-- # create our new variable, fill it with missing values -->
<!-- sea_ice$extent_mavg <- NA -->
<!-- # set our window size (in days) -->
<!-- window_size <- 365 -->
<!-- # when do we start our averaging? -->
<!-- start_at <- min(sea_ice$date) + days(window_size) -->
<!-- for (i in 1:nrow(sea_ice)) { -->
<!--     current_date <- sea_ice$date[i] -->
<!--     # are we at or beyond the start date yet? -->
<!--     if (current_date >= start_at) { -->
<!--       # identify the previous 12-month subset -->
<!--       from <- current_date - days(window_size) -->
<!--       sub_set <- filter(sea_ice, (date > from) & (date <= current_date)) -->
<!--       # calc and store average -->
<!--       sea_ice$extent_mavg[i] <- mean(sub_set$extent) -->
<!--     } -->
<!-- } -->
<!-- ``` -->
<!-- In a similar fashion to the previous group-averaging, now visualise -->
<!-- the moving average results over time. -->
<!-- ```{r sea-ice-extent-mavg, echo=FALSE, warning=FALSE, out.width="80%"} -->
<!-- ggplot(sea_ice) + geom_line(aes(x = date, y = extent_mavg)) -->
<!-- ``` -->
<!-- What happens to the graph when you modify your window size to be 6 months -->
<!-- (183 days)? What about a window size of 18 months (548 days)? -->
</div>
</div>
</div>
<div id="a-timestamp-split-over-several-columns" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> A timestamp split over several columns<a href="time.html#a-timestamp-split-over-several-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The original sea ice extent data did not actually contain a timestamp.
The timestamp you parsed earlier was created by combining several
columns in the original data. The original data is in
<code>orig_NH_seaice_extent.csv</code> on Moodle. Download this to your working
directory and load it into R:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="time.html#cb376-1" tabindex="-1"></a>sea_ice_orig <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;orig_NH_seaice_extent.csv&quot;</span>)</span>
<span id="cb376-2"><a href="time.html#cb376-2" tabindex="-1"></a><span class="fu">names</span>(sea_ice_orig)</span></code></pre></div>
<pre><code>## [1] &quot;Year&quot;        &quot;Month&quot;       &quot;Day&quot;         &quot;Extent&quot;      &quot;Missing&quot;    
## [6] &quot;Source.Data&quot;</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="time.html#cb378-1" tabindex="-1"></a><span class="co"># remove junk columns</span></span>
<span id="cb378-2"><a href="time.html#cb378-2" tabindex="-1"></a>sea_ice_orig <span class="ot">&lt;-</span> <span class="fu">select</span>(sea_ice_orig, <span class="sc">-</span>Missing, <span class="sc">-</span>Source.Data)</span>
<span id="cb378-3"><a href="time.html#cb378-3" tabindex="-1"></a><span class="fu">head</span>(sea_ice_orig)</span></code></pre></div>
<pre><code>##   Year Month Day   Extent
## 1 2014     1   1 12.97145
## 2 2014     1   2 13.06702
## 3 2014     1   3 13.13399
## 4 2014     1   4 13.22008
## 5 2014     1   5 13.12213
## 6 2014     1   6 13.11912</code></pre>
<p>We have three columns used to capture the time of the observation
(<code>Year</code>, <code>Month</code>, and <code>Day</code>). To turn this into a timestamp we need to
join each row of year, month and day together. To do this we use the
<code>glue()</code> function from the <code>glue</code> package. Install this package and then
load it using <code>library()</code>. Check the help page for <code>glue()</code> and test how
it works:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="time.html#cb380-1" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb380-2"><a href="time.html#cb380-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb380-3"><a href="time.html#cb380-3" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">09</span></span>
<span id="cb380-4"><a href="time.html#cb380-4" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb380-5"><a href="time.html#cb380-5" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&quot;{y}{m}{d}&quot;</span>)</span></code></pre></div>
<pre><code>## 2014915</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="time.html#cb382-1" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&quot;{y}/{m}/{d}&quot;</span>)</span></code></pre></div>
<pre><code>## 2014/9/15</code></pre>
<p>We can also use vectors:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="time.html#cb384-1" tabindex="-1"></a>animal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;monkey&quot;</span>, <span class="st">&quot;human&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;zebra&quot;</span>)</span>
<span id="cb384-2"><a href="time.html#cb384-2" tabindex="-1"></a>food <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pizza&quot;</span>, <span class="st">&quot;fish&quot;</span>, <span class="st">&quot;anything&quot;</span>, <span class="st">&quot;grass&quot;</span>)</span>
<span id="cb384-3"><a href="time.html#cb384-3" tabindex="-1"></a><span class="fu">glue</span>(<span class="st">&quot;{animal} would like {food}&quot;</span>)</span></code></pre></div>
<pre><code>## monkey would like banana
## human would like pizza
## cat would like fish
## dog would like anything
## zebra would like grass</code></pre>
<p>Use <code>glue()</code> along with <code>mutate()</code> to create a date variable within the
<code>sea_ice_orig</code> data frame, which should look something like this:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="time.html#cb386-1" tabindex="-1"></a><span class="fu">head</span>(sea_ice_orig)</span></code></pre></div>
<pre><code>##   Year Month Day   Extent       Date
## 1 2014     1   1 12.97145 2014-01-01
## 2 2014     1   2 13.06702 2014-01-02
## 3 2014     1   3 13.13399 2014-01-03
## 4 2014     1   4 13.22008 2014-01-04
## 5 2014     1   5 13.12213 2014-01-05
## 6 2014     1   6 13.11912 2014-01-06</code></pre>
<p>An alternative to <code>glue::glue()</code> is the function <code>stringr::str_c()</code>,
which, alongside other useful functions, is included in the <code>stringr</code>
package. We will cover the package next time, along with more general
ways to summarise a data frame.</p>
</div>
<div id="time-zones" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Time zones<a href="time.html#time-zones" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Time zones give multiple names to the same <em>instance</em> of time. For
example,</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="time.html#cb388-1" tabindex="-1"></a><span class="co"># Australian Christmas lunch</span></span>
<span id="cb388-2"><a href="time.html#cb388-2" tabindex="-1"></a>aus_christmas <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-12-25 13:00:00&quot;</span>,</span>
<span id="cb388-3"><a href="time.html#cb388-3" tabindex="-1"></a>                         <span class="at">tz =</span> <span class="st">&quot;Australia/Melbourne&quot;</span>)</span>
<span id="cb388-4"><a href="time.html#cb388-4" tabindex="-1"></a><span class="co"># In UK time</span></span>
<span id="cb388-5"><a href="time.html#cb388-5" tabindex="-1"></a><span class="fu">with_tz</span>(aus_christmas, <span class="at">tz =</span> <span class="st">&quot;GMT&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-25 02:00:00 GMT&quot;</code></pre>
<p>Both of these describe the same instant. The first shows how the instant
is labelled in Melbourne time (AEDT). While the second shows the same
instant but labelled in Greenwich Mean Time (GMT). Time zones complicate
date-time data but are useful for mapping clock time to local daylight
conditions. When working with instants, it is standard to give the clock
time as it appears in the Coordinated Universal time zone (UTC). This
saves calculations but can be annoying if your computer insists on
translating times to your current time zone. It may also be inconvenient
to discuss clock times that occur in a place unrelated to the data.</p>
<p>The <code>lubridate</code> package tries to ease the frustration caused by
different time zones in data by two ways. First, we can change the time
zone in which an instant is displayed by using the function <code>with_tz()</code>.
This changes how the clock time is displayed, but not the specific
instant of time that is referred to. For example:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="time.html#cb390-1" tabindex="-1"></a>uk_christmas <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-12-25 13:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;GMT&quot;</span>)</span>
<span id="cb390-2"><a href="time.html#cb390-2" tabindex="-1"></a><span class="fu">with_tz</span>(uk_christmas, <span class="st">&quot;UTC&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-25 13:00:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="time.html#cb392-1" tabindex="-1"></a><span class="fu">with_tz</span>(aus_christmas, <span class="st">&quot;UTC&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-25 02:00:00 UTC&quot;</code></pre>
<p>The <code>force_tz()</code> function does the opposite of <code>with_tz()</code>; it changes
the actual instant of time saved in the object, while keeping the
displayed clock time the same. The new time zone value is the indicator
of this change. For example, the code below moves us to a new instant
that occurs 11 hours later.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="time.html#cb394-1" tabindex="-1"></a><span class="fu">force_tz</span>(aus_christmas, <span class="st">&quot;UTC&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-25 13:00:00 UTC&quot;</code></pre>
<p>The <code>with_tz()</code> and <code>force_tz()</code> functions only work with time zones
recognised by R. To see a long list of these, use <code>OlsonNames()</code>.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="time.html#cb396-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">OlsonNames</span>())</span></code></pre></div>
<pre><code>## [1] &quot;Africa/Abidjan&quot;     &quot;Africa/Accra&quot;       &quot;Africa/Addis_Ababa&quot;
## [4] &quot;Africa/Algiers&quot;     &quot;Africa/Asmara&quot;      &quot;Africa/Asmera&quot;</code></pre>
<p>Finally, note that the <code>ymd_hms</code> family of functions will, by default,
parse all timestamps as being in the UTC timezone. Regardless of whether
the timestamp contains a reference to the actual timezone. Here is an
example of a timestamp in USA Eastern Standard Time (EST) being
overwritten as UTC:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="time.html#cb398-1" tabindex="-1"></a><span class="fu">ymd_hms</span>(<span class="st">&quot;2010-12-25 13:00:00 EST&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-25 13:00:00 UTC&quot;</code></pre>
<p>To ensure your timestamp is parsed as being in the correct timezone you
need to pass the timezone to the <code>tz</code> argument of the <code>ymd_hms()</code>
function:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="time.html#cb400-1" tabindex="-1"></a><span class="fu">ymd_hms</span>(<span class="st">&quot;2010-12-25 13:00:00 EST&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;EST&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-12-25 13:00:00 EST&quot;</code></pre>
<p>Note that the <code>tz</code> argument has to be a valid timezone otherwise
<code>with_tz()</code> will not perform the proper conversion when converting it to
a different timezone:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="time.html#cb402-1" tabindex="-1"></a><span class="fu">try</span>(tz_pickle <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-12-25 13:00:00&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;PICKLE&quot;</span>))</span></code></pre></div>
<pre><code>## Error in C_force_tz(to_posixct(time), tz, roll_dst) : 
##   CCTZ: Unrecognized output timezone: &quot;PICKLE&quot;</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="time.html#cb404-1" tabindex="-1"></a><span class="fu">try</span>(<span class="fu">with_tz</span>(tz_pickle, <span class="st">&quot;UTC&quot;</span>))</span></code></pre></div>
<pre><code>## Error in eval(expr, envir) : Objekt &#39;tz_pickle&#39; nicht gefunden</code></pre>
<p>The timezone PICKLE is silently replaced to UTC, even though PICKLE is
not an actual timezone. A more real example; while EST is a valid
timezone in R, USA Central Standard Time (CST) is not, although it <em>is</em>
an actual timezone. Instead of <code>CST</code> we have to use <code>CST6CDT</code> which
represents both the CST and CDT timezones (both are GMT - 6 hours).</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="time.html#cb406-1" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">OlsonNames</span>() <span class="sc">==</span> <span class="st">&quot;EST&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="time.html#cb408-1" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">OlsonNames</span>() <span class="sc">==</span> <span class="st">&quot;CST&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="time.html#cb410-1" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">OlsonNames</span>() <span class="sc">==</span> <span class="st">&quot;CST6CDT&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Because of all these issues, a good strategy is:</p>
<ul>
<li>Check your timezones are valid by comparing against <code>OlsonNames()</code>,
correcting any that are not.</li>
<li>Parse using the appropriate function.</li>
<li>Convert all timestamps to UTC.</li>
</ul>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="9">
<li id="fn9"><p>Note that this was the system time when this example was written.
<code>now()</code> will return a different timestamp each time it is used.<a href="time.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>This is collected by the National Snow and Ice Data Center (NSIDC)
and is available at: <a href="http://nsidc.org/data/G02135" class="uri">http://nsidc.org/data/G02135</a>.<a href="time.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>Try setting <code>name</code> in <code>brewer.pal()</code> to any of the following:
<code>BrBG</code>, <code>PiYG</code>, <code>PRGn</code>, <code>PuOr</code>, <code>RdBu</code>, <code>RdGy</code>, <code>RdYlBu</code>, <code>RdYlGn</code>,
<code>Spectral</code>.<a href="time.html#fnref11" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="read-plot.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="loops-sim.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
